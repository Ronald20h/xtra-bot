<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xtra System | Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#060614;--surface:#0b0b20;--card:#0f0f28;--card2:#13132e;--border:rgba(88,101,242,0.18);--accent:#5865F2;--accent2:#00d4ff;--accent3:#7c3aed;--green:#57f287;--red:#ed4245;--yellow:#fee75c;--orange:#f5a742;--text:#e8eaf6;--muted:#6b7280;--glow:rgba(88,101,242,0.35);--sidebar-w:265px;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px;}
.bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(88,101,242,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(88,101,242,0.04) 1px,transparent 1px);background-size:40px 40px;z-index:0;pointer-events:none;}

/* SERVERS */
#serversPage{display:none;min-height:100vh;padding:40px 20px;position:relative;z-index:1;}
.srv-header{text-align:center;margin-bottom:36px;}
.srv-header h1{font-family:'Orbitron',monospace;font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:6px;}
.user-bar{display:flex;align-items:center;gap:10px;justify-content:center;margin-bottom:24px;flex-wrap:wrap;}
.srv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;max-width:1100px;margin:0 auto;}
.srv-card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:22px;text-align:center;transition:all 0.3s;position:relative;overflow:hidden;}
.srv-card:hover{border-color:rgba(88,101,242,0.5);transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,0.3);}
.srv-icon{width:62px;height:62px;border-radius:50%;margin:0 auto 10px;object-fit:cover;border:2px solid var(--border);}
.srv-icon-ph{width:62px;height:62px;border-radius:50%;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:900;border:2px solid var(--border);}
.srv-name{font-weight:700;font-size:0.93rem;margin-bottom:4px;}
.srv-members{color:var(--muted);font-size:0.8rem;margin-bottom:12px;}
.prem-badge{position:absolute;top:10px;left:10px;background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;font-size:0.62rem;font-weight:900;padding:2px 8px;border-radius:999px;}
.bot-badge{display:inline-flex;align-items:center;gap:4px;font-size:0.76rem;padding:3px 10px;border-radius:999px;margin-bottom:10px;}
.bot-on{background:rgba(87,242,135,0.1);color:var(--green);border:1px solid rgba(87,242,135,0.25);}
.bot-off{background:rgba(107,114,128,0.1);color:var(--muted);border:1px solid var(--border);}
.btn-manage{display:block;padding:9px;background:linear-gradient(135deg,var(--accent),var(--accent3));border-radius:10px;color:white;font-family:'Tajawal',sans-serif;font-weight:700;font-size:0.85rem;border:none;cursor:pointer;width:100%;transition:all 0.3s;}
.btn-manage:hover{transform:scale(1.02);box-shadow:0 6px 20px var(--glow);}
.btn-add{display:block;padding:9px;background:transparent;border:2px solid var(--border);border-radius:10px;color:var(--muted);font-family:'Tajawal',sans-serif;font-weight:700;font-size:0.85rem;cursor:pointer;width:100%;transition:all 0.3s;text-decoration:none;text-align:center;}
.btn-add:hover{border-color:var(--accent);color:var(--accent2);}

/* DASHBOARD */
#dashPage{display:none;min-height:100vh;}
.sidebar{position:fixed;top:0;right:0;width:var(--sidebar-w);height:100vh;background:var(--surface);border-left:1px solid var(--border);z-index:100;display:flex;flex-direction:column;overflow-y:auto;transition:transform 0.3s;}
.sb-logo{padding:20px 16px;border-bottom:1px solid var(--border);}
.logo-txt{font-family:'Orbitron',monospace;font-size:1rem;font-weight:900;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sb-server{display:flex;align-items:center;gap:9px;padding:13px 16px;border-bottom:1px solid var(--border);cursor:pointer;}
.sb-server:hover{background:rgba(88,101,242,0.05);}
.sb-srv-icon{width:32px;height:32px;border-radius:8px;object-fit:cover;flex-shrink:0;}
.sb-srv-icon-ph{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:700;flex-shrink:0;}
.sb-srv-info{flex:1;overflow:hidden;}
.sb-srv-name{font-size:0.82rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.sb-srv-change{font-size:0.68rem;color:var(--muted);}
.sb-nav{flex:1;padding:12px 8px;}
.nav-sec{color:var(--muted);font-size:0.65rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:7px 10px;margin-top:6px;}
.ni{display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:10px;cursor:pointer;transition:all 0.2s;color:var(--muted);font-size:0.85rem;font-weight:500;}
.ni:hover{background:rgba(88,101,242,0.08);color:var(--text);}
.ni.active{background:linear-gradient(135deg,rgba(88,101,242,0.22),rgba(124,58,237,0.12));color:var(--accent2);border:1px solid rgba(88,101,242,0.18);}
.ni .ic{font-size:0.95rem;width:19px;text-align:center;}
.ni-gold{background:linear-gradient(135deg,rgba(245,167,66,0.12),rgba(254,231,92,0.06));color:#f5a742;border:1px solid rgba(245,167,66,0.18);}
.ni-admin{background:linear-gradient(135deg,rgba(237,66,69,0.1),rgba(237,66,69,0.05));color:var(--red);border:1px solid rgba(237,66,69,0.15);}
.sb-user{padding:13px 16px;border-top:1px solid var(--border);display:flex;align-items:center;gap:9px;}
.sb-av{width:30px;height:30px;border-radius:50%;object-fit:cover;}
.sb-av-ph{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent3));display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;}
.sb-uname{font-size:0.8rem;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-logout{background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.95rem;}
.btn-logout:hover{color:var(--red);}

.main{margin-right:var(--sidebar-w);min-height:100vh;padding:26px 30px;position:relative;z-index:1;}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.page-title{font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:900;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.plan-badge{padding:6px 13px;border-radius:999px;font-size:0.78rem;font-weight:700;}
.plan-free{background:rgba(107,114,128,0.15);border:1px solid rgba(107,114,128,0.2);color:var(--muted);}
.plan-prem{background:linear-gradient(135deg,rgba(245,167,66,0.2),rgba(254,231,92,0.1));border:1px solid rgba(245,167,66,0.4);color:#f5a742;}

/* PANELS */
.panel{display:none;animation:fadeUp 0.3s ease;}
.panel.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* CARDS */
.card{background:var(--card);border:1px solid var(--border);border-radius:15px;padding:22px;margin-bottom:18px;}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
.card-header h3{font-weight:700;font-size:0.97rem;display:flex;align-items:center;gap:7px;}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:18px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:18px;display:flex;align-items:center;gap:12px;transition:all 0.3s;}
.stat-card:hover{border-color:rgba(88,101,242,0.4);transform:translateY(-2px);}
.stat-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.stat-num{font-family:'Orbitron',monospace;font-size:1.4rem;font-weight:900;}
.stat-label{color:var(--muted);font-size:0.78rem;}

/* TOGGLE */
.tr{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);}
.tr:last-child{border-bottom:none;}
.tl .name{font-weight:600;font-size:0.9rem;}
.tl .desc{color:var(--muted);font-size:0.78rem;margin-top:1px;}
.toggle{position:relative;width:42px;height:22px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.ts{position:absolute;inset:0;background:rgba(107,114,128,0.35);border-radius:999px;cursor:pointer;transition:all 0.3s;}
.ts::before{content:'';position:absolute;width:16px;height:16px;background:white;border-radius:50%;top:3px;right:3px;transition:all 0.3s;}
.toggle input:checked+.ts{background:linear-gradient(135deg,var(--accent),var(--accent3));}
.toggle input:checked+.ts::before{right:auto;left:3px;}

/* FORM */
.fg{margin-bottom:16px;}
.fl{display:block;font-size:0.86rem;font-weight:600;margin-bottom:6px;}
.fl small{color:var(--muted);font-weight:400;}
.fi,.fs,.fta{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:10px 13px;color:var(--text);font-family:'Tajawal',sans-serif;font-size:0.9rem;outline:none;transition:all 0.3s;}
.fi:focus,.fs:focus,.fta:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(88,101,242,0.1);}
.fs option{background:var(--card2);}
.fta{min-height:85px;resize:vertical;}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

/* BUTTONS */
.btn{padding:9px 18px;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:0.88rem;font-weight:700;cursor:pointer;border:none;transition:all 0.25s;display:inline-flex;align-items:center;gap:6px;}
.btn-p{background:linear-gradient(135deg,var(--accent),var(--accent3));color:white;box-shadow:0 4px 15px var(--glow);}
.btn-p:hover{transform:translateY(-2px);}
.btn-d{background:rgba(237,66,69,0.12);color:var(--red);border:1px solid rgba(237,66,69,0.25);}
.btn-g{background:transparent;color:var(--muted);border:1px solid var(--border);}
.btn-g:hover{border-color:var(--accent);color:var(--text);}
.btn-s{padding:6px 12px;font-size:0.78rem;}
.btn-gold{background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,167,66,0.4);}
.btn-green{background:rgba(87,242,135,0.12);color:var(--green);border:1px solid rgba(87,242,135,0.25);}

/* AR */
.ar-list{display:flex;flex-direction:column;gap:9px;margin-bottom:14px;}
.ar-item{background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:12px;display:flex;gap:9px;align-items:center;}
.ar-trig{background:rgba(0,212,255,0.1);color:var(--accent2);padding:3px 9px;border-radius:7px;font-size:0.75rem;font-weight:600;white-space:nowrap;flex-shrink:0;}
.ar-resp{color:var(--muted);font-size:0.82rem;flex:1;}
.ar-del{background:none;border:none;color:var(--red);cursor:pointer;}

/* LOGS GRID */
.logs-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.log-item{background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:12px;display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;font-weight:600;}

/* PREMIUM PAGE */
.prem-hero{text-align:center;padding:36px 20px;background:linear-gradient(135deg,rgba(245,167,66,0.07),rgba(254,231,92,0.03));border:1px solid rgba(245,167,66,0.2);border-radius:18px;margin-bottom:22px;}
.plans-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;}
.plan-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:26px;text-align:center;transition:all 0.3s;}
.plan-card:hover{transform:translateY(-5px);}
.plan-card.feat{border-color:rgba(245,167,66,0.4);}
.plan-name{font-family:'Orbitron',monospace;font-size:1rem;font-weight:900;margin-bottom:5px;}
.plan-price{font-size:2rem;font-weight:900;margin:12px 0 4px;}
.plan-price span{font-size:0.85rem;color:var(--muted);}
.plan-features{list-style:none;text-align:right;margin:14px 0;display:flex;flex-direction:column;gap:7px;}
.plan-features li{display:flex;align-items:center;gap:6px;font-size:0.82rem;}
.plan-features li.y{color:var(--text);}
.plan-features li.y::before{content:'âœ“';color:var(--green);font-weight:700;}
.plan-features li.n{color:var(--muted);}
.plan-features li.n::before{content:'âœ•';color:var(--red);}

/* PAYMENT */
.payment-methods{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0;}
.pm-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center;cursor:pointer;transition:all 0.3s;}
.pm-card:hover{border-color:var(--accent);transform:translateY(-3px);}
.pm-icon{font-size:2rem;margin-bottom:8px;}
.pm-name{font-weight:700;font-size:0.9rem;margin-bottom:4px;}
.pm-desc{color:var(--muted);font-size:0.78rem;}

/* CONTACT */
.contact-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.contact-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;transition:all 0.3s;text-decoration:none;color:var(--text);}
.contact-card:hover{border-color:var(--accent2);transform:translateY(-4px);box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.contact-icon{font-size:2.5rem;margin-bottom:10px;}
.contact-name{font-weight:700;font-size:1rem;margin-bottom:4px;}
.contact-desc{color:var(--muted);font-size:0.82rem;}

/* ADMIN */
.admin-table{width:100%;border-collapse:separate;border-spacing:0;}
.admin-table th{text-align:right;padding:10px 14px;color:var(--muted);font-size:0.75rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;border-bottom:1px solid var(--border);}
.admin-table td{padding:12px 14px;border-bottom:1px solid rgba(88,101,242,0.06);font-size:0.86rem;vertical-align:middle;}
.admin-table tr:last-child td{border-bottom:none;}
.admin-table tr:hover td{background:rgba(88,101,242,0.03);}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.modal{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:30px;max-width:440px;width:90%;position:relative;animation:fadeUp 0.3s ease;}
.modal h3{font-size:1.1rem;font-weight:700;margin-bottom:16px;}
.modal-close{position:absolute;top:16px;left:16px;background:none;border:none;color:var(--muted);font-size:1.2rem;cursor:pointer;}

/* TOAST */
.toast-wrap{position:fixed;bottom:22px;left:22px;z-index:9999;display:flex;flex-direction:column;gap:8px;}
.toast{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:11px 16px;display:flex;align-items:center;gap:7px;font-size:0.85rem;font-weight:500;box-shadow:0 8px 25px rgba(0,0,0,0.3);animation:toastIn 0.3s ease;max-width:290px;}
.toast.success{border-color:rgba(87,242,135,0.3);color:var(--green);}
.toast.error{border-color:rgba(237,66,69,0.3);color:var(--red);}
.toast.info{border-color:rgba(0,212,255,0.3);color:var(--accent2);}
@keyframes toastIn{from{opacity:0;transform:translateX(-15px);}to{opacity:1;transform:translateX(0);}}
.loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--muted);}
.spinner{width:26px;height:26px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;margin-left:10px;}
@keyframes spin{to{transform:rotate(360deg);}}
.divider{border:none;border-top:1px solid var(--border);margin:18px 0;}
.tag{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:999px;font-size:0.75rem;font-weight:600;}
.tag-green{background:rgba(87,242,135,0.1);color:var(--green);border:1px solid rgba(87,242,135,0.25);}
.tag-yellow{background:rgba(254,231,92,0.1);color:var(--yellow);border:1px solid rgba(254,231,92,0.25);}
.tag-red{background:rgba(237,66,69,0.1);color:var(--red);border:1px solid rgba(237,66,69,0.25);}
.tag-blue{background:rgba(88,101,242,0.1);color:var(--accent2);border:1px solid rgba(88,101,242,0.25);}
.save-bar{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(88,101,242,0.07);border:1px solid rgba(88,101,242,0.15);border-radius:11px;margin-top:18px;}
.save-bar span{color:var(--muted);font-size:0.82rem;}

@media(max-width:900px){
  .sidebar{transform:translateX(100%);}.sidebar.open{transform:translateX(0);}
  .main{margin-right:0;padding:15px;}
  .plans-grid,.fg2,.logs-grid,.contact-grid,.payment-methods{grid-template-columns:1fr;}
  .mob-btn{display:flex!important;}
}
.mob-btn{display:none;position:fixed;top:13px;right:13px;z-index:200;background:var(--card);border:1px solid var(--border);border-radius:9px;padding:8px;cursor:pointer;font-size:1rem;}

/* COMMANDS GRID */
.cmds-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;}
.cmd-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:14px;transition:all 0.2s;position:relative;}
.cmd-card:hover{border-color:rgba(88,101,242,0.4);transform:translateY(-2px);}
.cmd-name{display:inline-flex;align-items:center;gap:6px;background:rgba(88,101,242,0.12);border:1px solid rgba(88,101,242,0.25);border-radius:8px;padding:4px 10px;font-family:'Orbitron',monospace;font-size:0.72rem;font-weight:700;color:var(--accent2);margin-bottom:8px;}
.cmd-desc{color:var(--text);font-size:0.84rem;font-weight:600;margin-bottom:4px;}
.cmd-usage{color:var(--muted);font-size:0.77rem;font-family:'Orbitron',monospace;}
.cmd-badge{position:absolute;top:10px;left:10px;font-size:0.6rem;font-weight:900;padding:2px 7px;border-radius:999px;}
.cmd-badge-prem{background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;}
.cmd-badge-mod{background:rgba(237,66,69,0.15);color:var(--red);border:1px solid rgba(237,66,69,0.3);}
.cmds-search{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-family:'Tajawal',sans-serif;font-size:0.9rem;outline:none;transition:all 0.3s;margin-bottom:16px;}
.cmds-search:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(88,101,242,0.1);}
.cmd-cat{display:inline-flex;align-items:center;gap:4px;font-size:0.68rem;font-weight:700;padding:2px 8px;border-radius:999px;background:rgba(0,212,255,0.08);color:var(--accent2);border:1px solid rgba(0,212,255,0.2);}
.cmd-card.editing{border-color:rgba(88,101,242,0.5);background:linear-gradient(135deg,rgba(88,101,242,0.05),rgba(0,212,255,0.02));}
.cmd-edit-input{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:7px 11px;color:var(--text);font-family:'Tajawal',sans-serif;font-size:0.88rem;outline:none;transition:all 0.3s;width:100%;}
.cmd-edit-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(88,101,242,0.1);}
</style>
</head>
<body>
<div class="bg-grid"></div>
<div class="toast-wrap" id="toastWrap"></div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" style="display:none;">
  <div class="modal" id="modalBox">
    <button class="modal-close" onclick="closeModal()">âœ•</button>
    <div id="modalContent"></div>
  </div>
</div>

<!-- SERVERS PAGE -->
<div id="serversPage">
  <div class="srv-header">
    <div class="user-bar" id="userBar"><div class="loading"><div class="spinner"></div></div></div>
    <h1>âš¡ Ø§Ø®ØªØ± Ø³ÙŠØ±ÙØ±Ùƒ</h1>
    <p style="color:var(--muted);">Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§</p>
  </div>
  <div class="srv-grid" id="serversGrid"><div class="loading" style="grid-column:1/-1;"><div class="spinner"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
</div>

<!-- DASHBOARD -->
<div id="dashPage">
  <button class="mob-btn" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button>
  <aside class="sidebar" id="sidebar">
    <div class="sb-logo"><div class="logo-txt">âš¡ XTRA SYSTEM</div></div>
    <div class="sb-server" onclick="goServers()">
      <div id="sbIcon" class="sb-srv-icon-ph" style="background:linear-gradient(135deg,#5865F2,#7c3aed);">âš¡</div>
      <div class="sb-srv-info">
        <div class="sb-srv-name" id="sbName">Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
        <div class="sb-srv-change">â† ØªØºÙŠÙŠØ± Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
      </div>
    </div>
    <nav class="sb-nav">
      <div class="nav-sec">Ø¹Ø§Ù…</div>
      <div class="ni active" onclick="showP('overview',this)"><span class="ic">ğŸ“Š</span> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="nav-sec">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      <div class="ni" onclick="showP('prefix',this)"><span class="ic">âŒ¨ï¸</span> Ø§Ù„Ø¨Ø±ÙÙƒØ³ ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø±</div>
      <div class="nav-sec">Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
      <div class="ni" onclick="showP('protection',this)"><span class="ic">ğŸ›¡ï¸</span> Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
      <div class="ni" onclick="showP('logs',this)"><span class="ic">ğŸ“‹</span> Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
      <div class="nav-sec">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</div>
      <div class="ni" onclick="showP('welcome',this)"><span class="ic">ğŸ‘‹</span> Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</div>
      <div class="ni" onclick="showP('autoresponse',this)"><span class="ic">ğŸ¤–</span> Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
      <div class="ni" onclick="showP('ticket',this)"><span class="ic">ğŸ«</span> Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±</div>
      <div class="ni" onclick="showP('suggestions',this)"><span class="ic">ğŸ’¡</span> Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</div>
      <div class="ni" onclick="showP('rank',this)"><span class="ic">â­</span> Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</div>
      <div class="nav-sec">Ø§Ù„Ø£ÙˆØ§Ù…Ø±</div>
      <div class="ni" onclick="showP('mod_cmds',this)"><span class="ic">ğŸ”¨</span> Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø´Ø±Ø§Ù</div>
      <div class="ni" onclick="showP('gen_cmds',this)"><span class="ic">ğŸ®</span> Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ø§Ù…Ø©</div>
      <div class="nav-sec">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</div>
      <div class="ni ni-gold" onclick="showP('levels',this)"><span class="ic">â­</span> Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ÙˆØ§Ù„Ù€ XP</div>
      <div class="ni ni-gold" onclick="showP('rankroles',this)"><span class="ic">ğŸ†</span> Ø±ØªØ¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
      <div class="nav-sec">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ÙˆØ¯Ø¹Ù…</div>
      <div class="ni ni-gold" onclick="showP('premium',this)"><span class="ic">ğŸ‘‘</span> Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div>
      <div class="ni" onclick="showP('contact',this)"><span class="ic">ğŸ’¬</span> Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù…</div>
      <div class="ni ni-admin" id="adminNavItem" style="display:none;" onclick="showP('admin',this)"><span class="ic">ğŸ”§</span> Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</div>
    </nav>
    <div style="display:flex;align-items:center;gap:9px;padding:12px 16px;background:linear-gradient(135deg,rgba(88,101,242,0.08),rgba(0,212,255,0.04));border-top:1px solid var(--border);">
      <div style="width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#5865F2,#00d4ff);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.9rem;flex-shrink:0;">S</div>
      <div style="flex:1;">
        <div style="font-size:0.82rem;font-weight:700;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">STEVEN</div>
        <div style="font-size:0.67rem;color:var(--muted);">ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
      </div>
      <a href="https://discord.gg/U3HNCzccbP" target="_blank" style="background:rgba(88,101,242,0.15);border:1px solid rgba(88,101,242,0.25);border-radius:8px;padding:5px 8px;color:var(--accent2);font-size:0.75rem;font-weight:700;text-decoration:none;">ğŸ’¬ Ø¯Ø¹Ù…</a>
    </div>
    <div class="sb-user">
      <div id="sbAv" class="sb-av-ph">ØŸ</div>
      <div class="sb-uname" id="sbUname">...</div>
      <button class="btn-logout" onclick="logout()">â</button>
    </div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="page-title" id="pageTitle">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="plan-badge plan-free" id="planBadge">âš¡ Free</div>
    </div>

    <!-- ====== OVERVIEW ====== -->
    <div class="panel active" id="panel-overview">
      <div class="stats-grid" id="statsGrid"><div class="stat-card"><div class="stat-icon" style="background:rgba(88,101,242,0.15);">â³</div><div><div class="stat-num">...</div><div class="stat-label">ØªØ­Ù…ÙŠÙ„</div></div></div></div>
      <div class="card"><div class="card-header"><h3>âš¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª</h3></div><div id="overviewInfo" style="color:var(--muted);padding:16px 0;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>

    <!-- ====== PREFIX ====== -->
    <div class="panel" id="panel-prefix">
      <div class="card">
        <div class="card-header"><h3>âŒ¨ï¸ Ø§Ù„Ø¨Ø±ÙÙƒØ³ ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø±</h3><button class="btn btn-p btn-s" onclick="savePrefix()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div class="fg">
          <label class="fl">Ø§Ù„Ø¨Ø±ÙÙƒØ³ Ø§Ù„Ø­Ø§Ù„ÙŠ <small>(Ø§Ù„Ø±Ù…Ø² Ù‚Ø¨Ù„ Ø§Ù„Ø£Ù…Ø± Ù…Ø«Ù„ ! Ø£Ùˆ .)</small></label>
          <input type="text" class="fi" id="prefixVal" placeholder="!" maxlength="5" style="max-width:120px;">
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:14px;margin-top:6px;">
          <p style="color:var(--muted);font-size:0.85rem;margin-bottom:8px;">ğŸ“Œ Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±ÙÙƒØ³:</p>
          <div id="prefixExamples" style="display:flex;gap:8px;flex-wrap:wrap;">
            <span class="tag tag-blue">!ban @user</span>
            <span class="tag tag-blue">!kick @user Ø³Ø¨Ø¨</span>
            <span class="tag tag-blue">!mute @user 10m</span>
            <span class="tag tag-blue">!warn @user</span>
          </div>
        </div>
        <div class="divider"></div>
        <div class="tr"><div class="tl"><div class="name">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙÙƒØ³</div><div class="desc">ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ù…Ø«Ù„ "ban" Ø¨Ø¯ÙˆÙ† "!"</div></div><label class="toggle"><input type="checkbox" id="noPrefixEnabled"><span class="ts"></span></label></div>
        <div class="tr"><div class="tl"><div class="name">Ø§Ù„Ø£ÙˆØ§Ù…Ø± Slash /</div><div class="desc">ØªÙØ¹ÙŠÙ„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø³Ù„Ø§Ø´ Ø§Ù„Ø±Ø³Ù…ÙŠØ©</div></div><label class="toggle"><input type="checkbox" id="slashEnabled" checked><span class="ts"></span></label></div>
        <div class="tr"><div class="tl"><div class="name">Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø±</div><div class="desc">Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ø¹Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±</div></div><label class="toggle"><input type="checkbox" id="deleteCmdMsg"><span class="ts"></span></label></div>
      </div>
    </div>

    <!-- ====== PROTECTION ====== -->
    <div class="panel" id="panel-protection">
      <div class="card">
        <div class="card-header"><h3>ğŸ›¡ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</h3><button class="btn btn-p btn-s" onclick="saveProtection()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="protContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== LOGS ====== -->
    <div class="panel" id="panel-logs">
      <div class="card">
        <div class="card-header"><h3>ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3><button class="btn btn-p btn-s" onclick="saveLogs()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="logsContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== WELCOME ====== -->
    <div class="panel" id="panel-welcome">
      <div class="card">
        <div class="card-header"><h3>ğŸ‘‹ Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</h3><button class="btn btn-p btn-s" onclick="saveWelcome()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="welcomeContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== AUTO RESPONSE ====== -->
    <div class="panel" id="panel-autoresponse">
      <div class="card">
        <div class="card-header"><h3>ğŸ¤– Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h3><button class="btn btn-p btn-s" onclick="showARForm()">+ Ø¥Ø¶Ø§ÙØ©</button></div>
        <div class="ar-list" id="arList"></div>
        <div id="arForm" style="display:none;background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:16px;">
          <div class="fg2">
            <div class="fg"><label class="fl">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø´ØºÙÙ‘Ù„Ø©</label><input type="text" class="fi" id="arTrigger" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø§Ø¹Ø¯Ø©"></div>
            <div class="fg"><label class="fl">Ù†ÙˆØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„</label><select class="fs" id="arType"><option value="contains">ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰</option><option value="startsWith">ÙŠØ¨Ø¯Ø£ Ø¨Ù€</option><option value="exact">ÙŠØ³Ø§ÙˆÙŠ ØªÙ…Ø§Ù…Ø§Ù‹</option></select></div>
          </div>
          <div class="fg"><label class="fl">Ø§Ù„Ø±Ø¯</label><textarea class="fta" id="arResp" placeholder="Ù†Øµ Ø§Ù„Ø±Ø¯..."></textarea></div>
          <div style="display:flex;gap:8px;"><button class="btn btn-p btn-s" onclick="addAR()">ğŸ’¾ Ø­ÙØ¸</button><button class="btn btn-g btn-s" onclick="document.getElementById('arForm').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button></div>
        </div>
      </div>
    </div>

    <!-- ====== TICKET ====== -->
    <div class="panel" id="panel-ticket">
      <div class="card">
        <div class="card-header"><h3>ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±</h3><button class="btn btn-p btn-s" onclick="saveTicket()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="ticketContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== SUGGESTIONS ====== -->
    <div class="panel" id="panel-suggestions">
      <div class="card">
        <div class="card-header"><h3>ğŸ’¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h3><button class="btn btn-p btn-s" onclick="saveSuggestions()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="suggestContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== PREMIUM ====== -->
    <div class="panel" id="panel-premium">
      <div class="prem-hero">
        <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ‘‘</div>
        <h2 style="font-family:'Orbitron',monospace;font-size:1.5rem;background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:6px;">XTRA PREMIUM</h2>
        <p style="color:var(--muted);">Ø§Ø±Ù‚Ù Ø¨Ø³ÙŠØ±ÙØ±Ùƒ Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ© Ù„Ø§ ØªØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</p>
        <div id="premStatusBox" style="margin-top:14px;"></div>
      </div>
      <div class="plans-grid">
        <div class="plan-card">
          <div class="plan-name">FREE</div>
          <div class="plan-price">$0 <span>/Ø´Ù‡Ø±</span></div>
          <ul class="plan-features">
            <li class="y">100 Ø£Ù…Ø± Ø£Ø³Ø§Ø³ÙŠ</li><li class="y">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± (Ù…Ø­Ø¯ÙˆØ¯)</li><li class="y">Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</li><li class="y">Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</li><li class="y">10 Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
            <li class="n">Ù…ÙˆØ³ÙŠÙ‚Ù‰ HD</li><li class="n">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</li><li class="n">Ø¯Ø¹Ù… Ø£ÙˆÙ„ÙˆÙŠØ©</li><li class="n">ØªØ°Ø§ÙƒØ± ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
          </ul>
          <button class="btn btn-g" style="width:100%;" disabled>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
        </div>
        <div class="plan-card feat">
          <div style="background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;font-size:0.68rem;font-weight:900;padding:3px 12px;border-radius:999px;display:inline-block;margin-bottom:9px;">â­ Ø§Ù„Ø£ÙØ¶Ù„</div>
          <div class="plan-name" style="background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">PREMIUM</div>
          <div class="plan-price" style="background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">$1 <span style="-webkit-text-fill-color:var(--muted);">/Ø´Ù‡Ø±</span></div>
          <ul class="plan-features">
            <li class="y">ÙƒÙ„ Ù…ÙŠØ²Ø§Øª Free</li><li class="y">ØªØ°Ø§ÙƒØ± ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li><li class="y">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ HD</li><li class="y">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</li><li class="y">Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li><li class="y">Ø­Ù…Ø§ÙŠØ© AI</li><li class="y">âš¡ Ø¯Ø¹Ù… Ø£ÙˆÙ„ÙˆÙŠØ© 24/7</li><li class="y">ØªØ®ØµÙŠØµ ÙƒØ§Ù…Ù„</li>
          </ul>
          <button class="btn btn-gold" style="width:100%;" onclick="showPayment()">ğŸ‘‘ Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† â€” $1</button>
        </div>
      </div>
      <!-- Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ -->
      <div class="card" id="paymentSection" style="display:none;">
        <div class="card-header"><h3>ğŸ’³ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</h3></div>
        <p style="color:var(--muted);font-size:0.88rem;margin-bottom:16px;">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ â€” Ø§Ù„Ø³Ø¹Ø± $1 Ø´Ù‡Ø±ÙŠØ§Ù‹ ÙÙ‚Ø·!</p>
        <div class="payment-methods">
          <div class="pm-card" onclick="showVodafoneInstructions()">
            <div class="pm-icon">ğŸ“±</div>
            <div class="pm-name">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</div>
            <div class="pm-desc">ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
          </div>
          <div class="pm-card" onclick="openTicketSupport()">
            <div class="pm-icon">ğŸ«</div>
            <div class="pm-name">ØªÙƒØª Ø¯Ø¹Ù…</div>
            <div class="pm-desc">Ø§ÙØªØ­ ØªÙƒØª ÙÙŠ Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù…</div>
          </div>
        </div>
      </div>
    </div>

        <!-- ====== CONTACT ====== -->
    <div class="panel" id="panel-contact">
      <div class="prem-hero" style="background:linear-gradient(135deg,rgba(88,101,242,0.08),rgba(0,212,255,0.04));">
        <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ‘¨â€ğŸ’»</div>
        <h2 style="font-family:'Orbitron',monospace;font-size:1.3rem;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">STEVEN â€” Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</h2>
        <p style="color:var(--muted);margin-top:6px;">Ø£ÙŠ Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ Ø§Ø³ØªÙØ³Ø§Ø±ØŸ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙˆÙ‡Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙˆØ±Ø§Ù‹ ğŸ’ª</p>
      </div>

      <div class="contact-grid">
        <a href="https://discord.gg/U3HNCzccbP" target="_blank" class="contact-card">
          <div class="contact-icon">ğŸ®</div>
          <div class="contact-name">Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ</div>
          <div class="contact-desc">Ø§Ù†Ø¶Ù… Ù„Ø³ÙŠØ±ÙØ± Xtra System ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
          <div style="margin-top:12px;background:rgba(88,101,242,0.15);border:1px solid rgba(88,101,242,0.3);border-radius:8px;padding:6px 14px;font-size:0.8rem;font-weight:700;color:var(--accent2);display:inline-block;">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† â†</div>
        </a>
        <a href="https://discord.com/channels/1440311353922555917/1447358530926547086" target="_blank" class="contact-card">
          <div class="contact-icon">ğŸ«</div>
          <div class="contact-name">Ø§ÙØªØ­ ØªÙƒØª Ø¯Ø¹Ù…</div>
          <div class="contact-desc">Ø§ÙØªØ­ ØªÙƒØª Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù… Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø£Ùˆ ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div>
          <div style="margin-top:12px;background:rgba(87,242,135,0.15);border:1px solid rgba(87,242,135,0.3);border-radius:8px;padding:6px 14px;font-size:0.8rem;font-weight:700;color:var(--green);display:inline-block;">ÙØªØ­ ØªÙƒØª â†</div>
        </a>
        <div class="contact-card" onclick="copyText('STEVEN#0000');toast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!','success')">
          <div class="contact-icon">ğŸ’¬</div>
          <div class="contact-name">Discord Ø§Ù„Ù…Ø·ÙˆØ±</div>
          <div class="contact-desc">ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± STEVEN Ø¹Ù„Ù‰ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</div>
          <div style="margin-top:12px;background:rgba(245,167,66,0.15);border:1px solid rgba(245,167,66,0.3);border-radius:8px;padding:6px 14px;font-size:0.8rem;font-weight:700;color:var(--orange);display:inline-block;font-family:'Orbitron',monospace;">STEVEN</div>
        </div>
        <div class="contact-card" onclick="showVodafoneInstructions()">
          <div class="contact-icon">ğŸ’³</div>
          <div class="contact-name">Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div>
          <div class="contact-desc">ÙØ¹Ù‘Ù„ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ù„Ø³ÙŠØ±ÙØ±Ùƒ Ø¨Ù€ $1 Ø´Ù‡Ø±ÙŠØ§Ù‹ â€” ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø£Ùˆ ØªÙƒØª</div>
          <div style="margin-top:12px;background:linear-gradient(135deg,rgba(245,167,66,0.2),rgba(254,231,92,0.1));border:1px solid rgba(245,167,66,0.4);border-radius:8px;padding:6px 14px;font-size:0.8rem;font-weight:900;color:var(--orange);display:inline-block;">ğŸ‘‘ $1 ÙÙ‚Ø· â†</div>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <div class="card-header"><h3>ğŸ“‹ ID Ø³ÙŠØ±ÙØ±Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3></div>
        <div style="display:flex;align-items:center;gap:10px;background:var(--card2);border-radius:10px;padding:14px;">
          <code style="font-family:'Orbitron',monospace;font-size:0.85rem;color:var(--accent2);flex:1;" id="currentGuildIdDisplay">-</code>
          <button class="btn btn-g btn-s" onclick="copyText(document.getElementById('currentGuildIdDisplay').textContent);toast('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù€ ID!','success')">ğŸ“‹ Ù†Ø³Ø®</button>
        </div>
        <p style="color:var(--muted);font-size:0.8rem;margin-top:8px;">Ø§Ø¨Ø¹Øª Ù‡Ø°Ø§ Ø§Ù„Ù€ ID Ù…Ø¹ Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</p>
      </div>
    </div>


    <!-- ====== RANK / XP ====== -->
    <div class="panel" id="panel-rank">
      <!-- Settings Card -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header"><h3>â­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h3><span id="rankPremBadge" class="tag tag-yellow" style="display:none;">ğŸ‘‘ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</span></div>
        <div id="rankSettingsForm">
          <div class="row2">
            <div class="fg">
              <label class="fl">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</label>
              <label class="toggle-wrap"><input type="checkbox" id="rankEnabled" class="toggle-input"><span class="toggle-slider"></span></label>
            </div>
            <div class="fg">
              <label class="fl">Ù‚Ù†Ø§Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠØ©</label>
              <select class="fi" id="rankLevelUpCh"><option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option></select>
            </div>
          </div>
          <div class="row2">
            <div class="fg">
              <label class="fl">XP Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø±Ø³Ø§Ù„Ø©</label>
              <input type="number" class="fi" id="rankXpMin" min="1" max="100" value="5">
            </div>
            <div class="fg">
              <label class="fl">XP Ø£Ù‚ØµÙ‰ Ù„Ù„Ø±Ø³Ø§Ù„Ø©</label>
              <input type="number" class="fi" id="rankXpMax" min="1" max="100" value="15">
            </div>
          </div>
          <div class="fg">
            <label class="fl">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ù‚ÙŠØ©</label>
            <input type="text" class="fi" id="rankLevelUpMsg" value="Ù…Ø¨Ø±ÙˆÙƒ {user}! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ **{level}** ğŸ‰" placeholder="Ù…ØªØºÙŠØ±Ø§Øª: {user} {level} {xp}">
            <small style="color:var(--muted);">Ù…ØªØºÙŠØ±Ø§Øª: {user} {level} {xp}</small>
          </div>
          <div style="display:flex;gap:10px;margin-top:4px;">
            <button class="btn btn-p" onclick="saveRankSettings()" style="flex:1;justify-content:center;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button class="btn btn-d btn-s" onclick="confirmResetAllXP()">ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„ XP</button>
          </div>
        </div>
      </div>

      <!-- Leaderboard Card -->
      <div class="card">
        <div class="card-header">
          <h3>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h3>
          <div style="display:flex;gap:8px;align-items:center;">
            <span id="rankTotal" class="tag tag-blue">0 Ø¹Ø¶Ùˆ</span>
            <button class="btn btn-g btn-s" onclick="loadRank()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
          </div>
        </div>
        <div id="rankLeaderboard" style="margin-top:8px;"></div>
      </div>
    </div>

    <!-- ====== LEVELS ====== -->
    <div class="panel" id="panel-levels">
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <h3>â­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h3>
          <span class="tag tag-yellow">ğŸ‘‘ Premium</span>
        </div>
        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:16px;">Ø¹Ø¶Ùˆ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ XP Ø¨ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙŠØ¨Ø¹ØªÙ‡Ø§ â€” ÙƒÙ„ 100 XP = Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</p>
        <div class="fg">
          <label class="fl">ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</label>
          <label class="toggle"><input type="checkbox" id="lvlEnabled"><span class="slider"></span></label>
        </div>
        <div class="fg">
          <label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù„Ù…Ø§ Ø­Ø¯ ÙŠØ±Ù‚Ù‰ Ù…Ø³ØªÙˆÙ‰)</label>
          <select class="fi" id="lvlChannel"><option value="">Ø¨Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</option></select>
        </div>
        <div class="fg">
          <label class="fl">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ù‚ÙŠØ© <small style="color:var(--muted);">Ù…ØªØºÙŠØ±Ø§Øª: {user} {level} {xp}</small></label>
          <input type="text" class="fi" id="lvlMessage" value="Ù…Ø¨Ø±ÙˆÙƒ {user}! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ {level} ğŸ‰">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div class="fg">
            <label class="fl">Ø£Ù‚Ù„ XP Ù„Ù„Ø±Ø³Ø§Ù„Ø©</label>
            <input type="number" class="fi" id="lvlMinXp" value="5" min="1" max="50">
          </div>
          <div class="fg">
            <label class="fl">Ø£ÙƒØªØ± XP Ù„Ù„Ø±Ø³Ø§Ù„Ø©</label>
            <input type="number" class="fi" id="lvlMaxXp" value="15" min="1" max="100">
          </div>
        </div>
        <div class="fg">
          <label class="fl">Ù…Ø¶Ø§Ø¹Ù XP Ù„Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… (Ù„Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…)</label>
          <input type="number" class="fi" id="lvlMultiplier" value="2" min="1" max="5" step="0.5">
        </div>
        <div class="fg">
          <label class="fl">Ù‚Ù†ÙˆØ§Øª Ù…Ø³ØªØ«Ù†Ø§Ø© (Ù…Ø´ Ø¨ØªØ¯ÙŠ XP)</label>
          <select class="fi" id="lvlIgnoredChannels" multiple style="height:80px;"></select>
        </div>
        <button class="btn btn-p" style="margin-top:8px;" onclick="saveLevels()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>

      <div class="card">
        <div class="card-header"><h3>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h3></div>
        <div id="lvlLeaderboard"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== RANK ROLES ====== -->
    <div class="panel" id="panel-rankroles">
      <div class="card">
        <div class="card-header">
          <h3>ğŸ† Ø±ØªØ¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3>
          <span class="tag tag-yellow">ğŸ‘‘ Premium</span>
        </div>
        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:16px;">Ø¹ÙŠÙ‘Ù† Ø±ØªØ¨Ø© ØªÙØ¹Ø·Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù…Ø§ Ø¹Ø¶Ùˆ ÙŠÙˆØµÙ„ Ù„Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹ÙŠÙ†</p>
        
        <div style="background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:16px;">
          <div style="font-size:0.85rem;font-weight:700;margin-bottom:12px;color:var(--accent2);">â• Ø¥Ø¶Ø§ÙØ© Ø±ØªØ¨Ø© Ù…Ø³ØªÙˆÙ‰</div>
          <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end;">
            <div class="fg" style="margin-bottom:0;">
              <label class="fl">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
              <input type="number" class="fi" id="rrLevel" placeholder="5" min="1" max="100">
            </div>
            <div class="fg" style="margin-bottom:0;">
              <label class="fl">Ø§Ù„Ø±ØªØ¨Ø©</label>
              <select class="fi" id="rrRole"></select>
            </div>
            <button class="btn btn-p" onclick="addRankRole()" style="white-space:nowrap;">â• Ø¥Ø¶Ø§ÙØ©</button>
          </div>
        </div>

        <div id="rankRolesList"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- ====== MOD COMMANDS ====== -->
    <div class="panel" id="panel-mod_cmds">
      <div class="card">
        <div class="card-header"><h3>ğŸ”¨ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø´Ø±Ø§Ù</h3><span class="tag tag-blue">prefix + Ø§Ù„Ø£Ù…Ø±</span></div>
        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:16px;">Ø¬Ù…ÙŠØ¹ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø¨ÙˆØª â€” Ø§Ø³ØªØ¨Ø¯Ù„ <strong style="color:var(--accent2);">!</strong> Ø¨Ø§Ù„Ø¨Ø±ÙÙƒØ³ Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ</p>
        <div id="modCmdsGrid" class="cmds-grid"></div>
      </div>
    </div>

    <!-- ====== GEN COMMANDS ====== -->
    <div class="panel" id="panel-gen_cmds">
      <div class="card">
        <div class="card-header"><h3>ğŸ® Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ø§Ù…Ø©</h3><span class="tag tag-green">Ù…ØªØ§Ø­ Ù„Ù„Ø¬Ù…ÙŠØ¹</span></div>
        <p style="color:var(--muted);font-size:0.85rem;margin-bottom:16px;">Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„Ù„ÙŠ ÙŠÙ‚Ø¯Ø± ÙŠØ³ØªØ®Ø¯Ù…Ù‡Ø§ ÙƒÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
        <div id="genCmdsGrid" class="cmds-grid"></div>
      </div>
    </div>

    <!-- ====== ADMIN ====== -->
    <div class="panel" id="panel-admin">
      <div class="stats-grid" id="adminStats"><div class="stat-card"><div class="stat-icon" style="background:rgba(237,66,69,0.15);">â³</div><div><div class="stat-num">...</div><div class="stat-label">ØªØ­Ù…ÙŠÙ„</div></div></div></div>
      <div class="card">
        <div class="card-header"><h3>ğŸ‘‘ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</h3><button class="btn btn-p btn-s" onclick="showGrantModal()">+ Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</button></div>
        <div id="premiumList"><div class="loading"><div class="spinner"></div></div></div>
      </div>
      <div class="card">
        <div class="card-header"><h3>ğŸ–¥ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª</h3></div>
        <div id="adminGuildsList"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

  </main>
</div>

<script>
// ===== STATE =====
let currentGuildId = null;
let isPremiumGuild = false;
let rankSettings = {};
let guildInfo = {channels:[],roles:[],categories:[]};
let arData = [];
let isAdmin = false;
let CLIENT_ID = '';

// ===== INIT =====
window.onload = async () => {
  try {
    const cfg = await fetch('/api/config'); const cfgData = await cfg.json();
    CLIENT_ID = cfgData.clientId || '';
  } catch {}
  await loadUser();
  await loadServers();

  // Ù„Ùˆ Ø¬Ø§ÙŠ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙˆØªØŒ Ø§ÙØªØ­ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¯Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©
  const params = new URLSearchParams(window.location.search);
  const autoGuild = params.get('guild');
  if (autoGuild) {
    // Ù†Ù…Ø³Ø­ Ø§Ù„Ù€ param Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¯ÙˆÙ† reload
    window.history.replaceState({}, '', '/dashboard');
    // Ø¯ÙˆØ± Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§ÙØªØ­Ù‡
    const r = await fetch('/api/guilds');
    const guilds = await r.json();
    const g = guilds.find(g => g.id === autoGuild);
    if (g && g.hasBot) {
      enterDash(g.id, g.name, g.icon||'', String(g.isPremium));
      return;
    }
  }

  document.getElementById('serversPage').style.display = 'block';
};

// ===== USER =====
async function loadUser() {
  try {
    const r = await fetch('/api/me'); if(!r.ok){window.location.href='/';return;}
    const u = await r.json(); isAdmin = u.isAdmin;
    document.getElementById('userBar').innerHTML = `
      <img src="${u.avatar}" style="width:36px;height:36px;border-radius:50%;border:2px solid var(--accent);" onerror="this.style.display='none'">
      <span style="font-weight:600;">${u.tag}</span>
      ${u.isAdmin?'<span class="tag tag-red">ğŸ”§ Ø£Ø¯Ù…Ù†</span>':''}
      <button class="btn btn-g btn-s" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    `;
    document.getElementById('sbUname').textContent = u.username;
    const avEl = document.getElementById('sbAv');
    avEl.innerHTML = `<img src="${u.avatar}" class="sb-av" onerror="this.outerHTML='<div class=sb-av-ph>${u.username[0]}</div>'">`;
    if(u.isAdmin) document.getElementById('adminNavItem').style.display='flex';
  } catch { window.location.href='/'; }
}

// ===== SERVERS =====
async function loadServers() {
  try {
    const r = await fetch('/api/guilds'); const guilds = await r.json();
    const grid = document.getElementById('serversGrid');
    if(!guilds.length){grid.innerHTML='<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:40px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ±ÙØ±Ø§Øª</div>';return;}
    grid.innerHTML = guilds.map(g=>`
      <div class="srv-card">
        ${g.isPremium?'<div class="prem-badge">ğŸ‘‘ Premium</div>':''}
        ${g.icon?`<img src="${g.icon}" class="srv-icon" onerror="this.outerHTML='<div class=srv-icon-ph style=background:linear-gradient(135deg,#5865F2,#7c3aed)>${g.name[0]}</div>'">`:`<div class="srv-icon-ph" style="background:linear-gradient(135deg,#5865F2,#7c3aed);">${g.name[0]}</div>`}
        <div class="srv-name">${g.name}</div>
        <div class="srv-members">ğŸ‘¥ ${g.memberCount?g.memberCount.toLocaleString():'?'} Ø¹Ø¶Ùˆ</div>
        <div class="bot-badge ${g.hasBot?'bot-on':'bot-off'}">${g.hasBot?'â— Ø§Ù„Ø¨ÙˆØª Ù…ÙˆØ¬ÙˆØ¯':'â—‹ Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± Ù…Ø¶Ø§Ù'}</div>
        ${g.hasBot
          ?`<button class="btn-manage" onclick="enterDash('${g.id}','${g.name}','${g.icon||''}','${g.isPremium}')">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</button>`
          :`<a class="btn-add" href="#" onclick="addBot('${g.id}');return false;">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙˆØª</a>`
        }
      </div>`).join('');
  } catch { document.getElementById('serversGrid').innerHTML='<div style="grid-column:1/-1;text-align:center;color:var(--red);padding:40px;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>'; }
}

// ===== ENTER DASH =====
async function enterDash(id,name,icon,isPrem) {
  currentGuildId=id;
  isPremiumGuild = (isPrem === 'true' || isPrem === true);
  document.getElementById('serversPage').style.display='none';
  document.getElementById('dashPage').style.display='block';
  document.getElementById('sbName').textContent=name;
  const si=document.getElementById('sbIcon');
  if(icon){si.innerHTML=`<img src="${icon}" class="sb-srv-icon" onerror="this.outerHTML='<div class=sb-srv-icon-ph style=background:linear-gradient(135deg,#5865F2,#7c3aed)>${name[0]}</div>'">`;}
  else{si.textContent=name[0];}
  const b=document.getElementById('planBadge');
  if(isPrem==='true'){b.className='plan-badge plan-prem';b.textContent='ğŸ‘‘ Premium';}
  else{b.className='plan-badge plan-free';b.textContent='âš¡ Free';}
  try{const r=await fetch(`/api/guild/${id}/info`);guildInfo=await r.json();}catch{guildInfo={channels:[],roles:[],categories:[]};}
  const gEl=document.getElementById('currentGuildIdDisplay');if(gEl)gEl.textContent=id;
  loadOverview();
  showP('overview',document.querySelector('.ni'));
}

function goServers(){document.getElementById('dashPage').style.display='none';document.getElementById('serversPage').style.display='block';currentGuildId=null;}
function logout(){window.location.href='/logout';}

// ===== PANELS =====
const TITLES={overview:'ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©',prefix:'âŒ¨ï¸ Ø§Ù„Ø¨Ø±ÙÙƒØ³ ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø±',protection:'ğŸ›¡ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ©',logs:'ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª',welcome:'ğŸ‘‹ Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹',autoresponse:'ğŸ¤– Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ',ticket:'ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±',suggestions:'ğŸ’¡ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',premium:'ğŸ‘‘ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…',contact:'ğŸ’¬ Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù…',admin:'ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†',mod_cmds:'ğŸ”¨ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø´Ø±Ø§Ù',gen_cmds:'ğŸ® Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ø§Ù…Ø©',rank:'â­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª',levels:'â­ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ÙˆØ§Ù„Ù€ XP',rankroles:'ğŸ† Ø±ØªØ¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰'};
const LOADERS={protection:loadProtection,logs:loadLogs,welcome:loadWelcome,autoresponse:loadAR,ticket:loadTicket,suggestions:loadSuggestions,premium:loadPremium,admin:loadAdmin,prefix:loadPrefix,mod_cmds:loadModCmds,gen_cmds:loadGenCmds,rank:loadRank};

function showP(name,el){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  if(el)el.classList.add('active');
  document.getElementById('pageTitle').textContent=TITLES[name]||name;
  if(LOADERS[name])LOADERS[name]();
  if(window.innerWidth<=900)document.getElementById('sidebar').classList.remove('open');
}

// ===== HELPERS =====
function ch(sel,v=''){return`<option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>`+guildInfo.channels.map(c=>`<option value="${c.id}"${c.id===v?' selected':''}># ${c.name}</option>`).join('');}
function ro(sel,v=''){return`<option value="">Ø§Ø®ØªØ± Ø±ØªØ¨Ø©</option>`+guildInfo.roles.map(r=>`<option value="${r.id}"${r.id===v?' selected':''}>@ ${r.name}</option>`).join('');}
function cat(v=''){return`<option value="">Ø§Ø®ØªØ± ÙƒØ§ØªÙŠØºÙˆØ±ÙŠ</option>`+(guildInfo.categories||[]).map(c=>`<option value="${c.id}"${c.id===v?' selected':''}>${c.name}</option>`).join('');}

// ===== OVERVIEW =====
async function loadOverview(){
  try{
    const r=await fetch(`/api/guild/${currentGuildId}/stats`); const s=await r.json();
    document.getElementById('statsGrid').innerHTML=`
      <div class="stat-card"><div class="stat-icon" style="background:rgba(88,101,242,0.15);">ğŸ‘¥</div><div><div class="stat-num">${s.memberCount.toLocaleString()}</div><div class="stat-label">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(87,242,135,0.15);">ğŸŸ¢</div><div><div class="stat-num">${s.onlineCount.toLocaleString()}</div><div class="stat-label">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(0,212,255,0.15);">ğŸ«</div><div><div class="stat-num">${s.openTickets}</div><div class="stat-label">ØªØ°Ø§ÙƒØ± Ù…ÙØªÙˆØ­Ø©</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(237,66,69,0.15);">âš ï¸</div><div><div class="stat-num">${s.warns}</div><div class="stat-label">Ø¥Ù†Ø°Ø§Ø±Ø§Øª</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(245,167,66,0.15);">ğŸ‘‘</div><div><div class="stat-num">${s.isPremium?'âœ…':'âŒ'}</div><div class="stat-label">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div></div></div>
    `;
    document.getElementById('overviewInfo').innerHTML=`
      <div style="display:flex;flex-direction:column;gap:10px;">
        <div style="display:flex;align-items:center;gap:10px;background:var(--card2);border-radius:10px;padding:12px;">
          <span style="font-size:1.3rem;">âœ…</span>
          <div><div style="font-weight:600;">Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</div><div style="color:var(--muted);font-size:0.82rem;">Ù…ØªØµÙ„ Ø¨Ø³ÙŠØ±ÙØ± ${document.getElementById('sbName').textContent}</div></div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;background:var(--card2);border-radius:10px;padding:12px;">
          <span style="font-size:1.3rem;">ğŸ’¬</span>
          <div><div style="font-weight:600;">Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</div><div style="color:var(--muted);font-size:0.82rem;">Ø§Ù†Ø¶Ù… Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù… Ø£Ùˆ Ø§ÙØªØ­ ØªÙƒØª</div></div>
          <a href="https://discord.gg/U3HNCzccbP" target="_blank" class="btn btn-p btn-s" style="margin-right:auto;">ğŸ® Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù…</a>
        </div>
      </div>
    `;
  }catch{document.getElementById('overviewInfo').textContent='Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';}
}

// ===== PREFIX =====
async function loadPrefix(){
  try{const r=await fetch(`/api/guild/${currentGuildId}/prefix`);const d=await r.json();
  document.getElementById('prefixVal').value=d.prefix||'!';}catch{}
}
async function savePrefix(){
  const prefix=document.getElementById('prefixVal').value.trim()||'!';
  const r=await fetch(`/api/guild/${currentGuildId}/prefix`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prefix})});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙÙƒØ³','success'):toast('âŒ Ø®Ø·Ø£','error');
  document.getElementById('prefixExamples').innerHTML=[`${prefix}ban @user`,`${prefix}kick @user Ø³Ø¨Ø¨`,`${prefix}mute @user 10m`,`${prefix}warn @user`].map(x=>`<span class="tag tag-blue">${x}</span>`).join('');
}

// ===== PROTECTION =====
async function loadProtection(){
  const r=await fetch(`/api/guild/${currentGuildId}/protection`); const d=await r.json();
  document.getElementById('protContent').innerHTML=`
    <div class="tr"><div class="tl"><div class="name">Anti-Raid ğŸš¨</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ù…ÙØ§Ø¬Ø¦</div></div><label class="toggle"><input type="checkbox" id="pAntiRaid" ${d.antiRaid?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Spam ğŸ’¬</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©</div></div><label class="toggle"><input type="checkbox" id="pAntiSpam" ${d.antiSpam?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Link ğŸ”—</div><div class="desc">Ø­Ø°Ù Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div></div><label class="toggle"><input type="checkbox" id="pAntiLink" ${d.antiLink?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Ad ğŸ“¢</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø¹ÙˆØ§Øª</div></div><label class="toggle"><input type="checkbox" id="pAntiAd" ${d.antiAd?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Mention ğŸ“£</div><div class="desc">Ù…Ù†Ø¹ Ù…Ù†Ø´Ù† Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ÙØ±Ø·</div></div><label class="toggle"><input type="checkbox" id="pAntiMention" ${d.antiMention?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Emoji ğŸ˜‚</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙØ±Ø·</div></div><label class="toggle"><input type="checkbox" id="pAntiEmoji" ${d.antiEmoji?'checked':''}><span class="ts"></span></label></div>
    <div class="tr"><div class="tl"><div class="name">Anti-Caps ğŸ” </div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø©</div></div><label class="toggle"><input type="checkbox" id="pAntiCaps" ${d.antiCaps?'checked':''}><span class="ts"></span></label></div>
    <div class="fg2" style="margin-top:16px;">
      <div class="fg"><label class="fl">Ø­Ø¯ Ø§Ù„Ø±ÙŠØ¯ <small>(ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©)</small></label><input type="number" class="fi" id="pRaidLimit" value="${d.raidLimit||10}"></div>
      <div class="fg"><label class="fl">Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±ÙŠØ¯</label><select class="fs" id="pRaidAction"><option value="lock" ${d.raidAction==='lock'?'selected':''}>Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±</option><option value="ban" ${d.raidAction==='ban'?'selected':''}>Ø­Ø¸Ø±</option><option value="kick" ${d.raidAction==='kick'?'selected':''}>Ø·Ø±Ø¯</option></select></div>
      <div class="fg"><label class="fl">Ø­Ø¯ Ø§Ù„Ø³Ø¨Ø§Ù… <small>(Ø±Ø³Ø§Ù„Ø©/Ø«Ø§Ù†ÙŠØ©)</small></label><input type="number" class="fi" id="pSpamLimit" value="${d.spamLimit||5}"></div>
    </div>
  `;
}
async function saveProtection(){
  const body={antiRaid:document.getElementById('pAntiRaid').checked,antiSpam:document.getElementById('pAntiSpam').checked,antiLink:document.getElementById('pAntiLink').checked,antiAd:document.getElementById('pAntiAd').checked,antiMention:document.getElementById('pAntiMention').checked,antiEmoji:document.getElementById('pAntiEmoji').checked,antiCaps:document.getElementById('pAntiCaps').checked,raidLimit:parseInt(document.getElementById('pRaidLimit').value),spamLimit:parseInt(document.getElementById('pSpamLimit').value),raidAction:document.getElementById('pRaidAction').value};
  const r=await fetch(`/api/guild/${currentGuildId}/protection`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ©','success'):toast('âŒ Ø®Ø·Ø£','error');
}

// ===== LOGS =====
async function loadLogs(){
  const r=await fetch(`/api/guild/${currentGuildId}/logs`); const d=await r.json();
  document.getElementById('logsContent').innerHTML=`
    <div class="fg"><label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</label><select class="fs" id="lChannel"><option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>${ch('',d.channel)}</select></div>
    <div class="tr"><div class="tl"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div></div><label class="toggle"><input type="checkbox" id="lEnabled" ${d.enabled?'checked':''}><span class="ts"></span></label></div>
    <div class="logs-grid" style="margin-top:14px;">
      <div class="log-item">ğŸ‘‹ Ø§Ù†Ø¶Ù…Ø§Ù…<label class="toggle"><input type="checkbox" id="lJoin" ${d.memberJoin?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸšª Ù…ØºØ§Ø¯Ø±Ø©<label class="toggle"><input type="checkbox" id="lLeave" ${d.memberLeave?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„<label class="toggle"><input type="checkbox" id="lEdit" ${d.messageEdit?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ—‘ï¸ Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„<label class="toggle"><input type="checkbox" id="lDelete" ${d.messageDelete?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ”¨ Ø¹Ù‚ÙˆØ¨Ø§Øª<label class="toggle"><input type="checkbox" id="lPunish" ${d.punishments?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ« ØªØ°Ø§ÙƒØ±<label class="toggle"><input type="checkbox" id="lTicket" ${d.ticketEvents?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ¤ ØµÙˆØª<label class="toggle"><input type="checkbox" id="lVoice" ${d.voiceEvents?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ”§ ØªØºÙŠÙŠØ±Ø§Øª<label class="toggle"><input type="checkbox" id="lServer" ${d.serverChanges?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ‘‘ Ø±ØªØ¨<label class="toggle"><input type="checkbox" id="lRoles" ${d.roleChanges?'checked':''}><span class="ts"></span></label></div>
      <div class="log-item">ğŸ“ Ù‚Ù†ÙˆØ§Øª<label class="toggle"><input type="checkbox" id="lChannels" ${d.channelChanges?'checked':''}><span class="ts"></span></label></div>
    </div>
  `;
}
async function saveLogs(){
  const body={enabled:document.getElementById('lEnabled').checked,channel:document.getElementById('lChannel').value,memberJoin:document.getElementById('lJoin').checked,memberLeave:document.getElementById('lLeave').checked,messageEdit:document.getElementById('lEdit').checked,messageDelete:document.getElementById('lDelete').checked,punishments:document.getElementById('lPunish').checked,ticketEvents:document.getElementById('lTicket').checked,voiceEvents:document.getElementById('lVoice').checked,serverChanges:document.getElementById('lServer').checked,roleChanges:document.getElementById('lRoles').checked,channelChanges:document.getElementById('lChannels').checked};
  const r=await fetch(`/api/guild/${currentGuildId}/logs`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª','success'):toast('âŒ Ø®Ø·Ø£','error');
}

// ===== WELCOME =====
async function loadWelcome(){
  const r=await fetch(`/api/guild/${currentGuildId}/welcome`); const d=await r.json();
  document.getElementById('welcomeContent').innerHTML=`
    <div class="tr"><div class="tl"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø­ÙŠØ¨</div></div><label class="toggle"><input type="checkbox" id="wEnabled" ${d.enabled?'checked':''}><span class="ts"></span></label></div>
    <div class="fg2" style="margin-top:14px;">
      <div class="fg"><label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨</label><select class="fs" id="wChannel">${ch('',d.channel)}</select></div>
      <div class="fg"><label class="fl">Ø±ØªØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</label><select class="fs" id="wAutoRole">${ro('',d.autoRole)}</select></div>
    </div>
    <div class="fg"><label class="fl">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ <small>({user} {server} {count} {mention})</small></label><textarea class="fta" id="wMsg">${d.message||''}</textarea></div>
    <div class="tr"><div class="tl"><div class="name">Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ© (DM) Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</div></div><label class="toggle"><input type="checkbox" id="wDM" ${d.dmEnabled?'checked':''}><span class="ts"></span></label></div>
    <div class="fg" style="margin-top:10px;"><label class="fl">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§ØµØ©</label><textarea class="fta" id="wDMMsg">${d.dmMessage||''}</textarea></div>
    <hr class="divider">
    <div class="tr"><div class="tl"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¯Ø§Ø¹</div></div><label class="toggle"><input type="checkbox" id="lEnabled2" ${d.leaveEnabled?'checked':''}><span class="ts"></span></label></div>
    <div class="fg" style="margin-top:12px;"><label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„ÙˆØ¯Ø§Ø¹</label><select class="fs" id="lChannel2">${ch('',d.leaveChannel)}</select></div>
    <div class="fg"><label class="fl">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ¯Ø§Ø¹</label><textarea class="fta" id="lMsg">${d.leaveMessage||''}</textarea></div>
  `;
}
async function saveWelcome(){
  const body={enabled:document.getElementById('wEnabled').checked,channel:document.getElementById('wChannel').value,message:document.getElementById('wMsg').value,autoRole:document.getElementById('wAutoRole').value,dmEnabled:document.getElementById('wDM').checked,dmMessage:document.getElementById('wDMMsg').value,leaveEnabled:document.getElementById('lEnabled2').checked,leaveChannel:document.getElementById('lChannel2').value,leaveMessage:document.getElementById('lMsg').value};
  const r=await fetch(`/api/guild/${currentGuildId}/welcome`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠØ¨','success'):toast('âŒ Ø®Ø·Ø£','error');
}

// ===== AR =====
async function loadAR(){
  const r=await fetch(`/api/guild/${currentGuildId}/autoresponse`); arData=await r.json(); renderAR();
}
function renderAR(){
  const list=document.getElementById('arList');
  if(!arData.length){list.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© â€” Ø§Ø¶ØºØ· + Ø¥Ø¶Ø§ÙØ©</div>';return;}
  list.innerHTML=arData.map((ar,i)=>`<div class="ar-item"><span class="ar-trig">${ar.trigger}</span><div class="ar-resp">${ar.response}</div><button class="ar-del" onclick="delAR(${i})">ğŸ—‘ï¸</button></div>`).join('');
}
function showARForm(){document.getElementById('arForm').style.display='block';}
async function addAR(){
  const t=document.getElementById('arTrigger').value.trim(),r2=document.getElementById('arResp').value.trim();
  if(!t||!r2){toast('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ø±Ø¯!','error');return;}
  arData.push({trigger:t,type:document.getElementById('arType').value,response:r2});
  await saveARData(); document.getElementById('arForm').style.display='none';
  document.getElementById('arTrigger').value='';document.getElementById('arResp').value='';renderAR();
}
async function delAR(i){arData.splice(i,1);await saveARData();renderAR();}
async function saveARData(){
  const r=await fetch(`/api/guild/${currentGuildId}/autoresponse`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({responses:arData})});
  const d=await r.json(); if(d.success)toast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸','success');
}

// ===== TICKET =====
async function loadTicket(){
  const r=await fetch(`/api/guild/${currentGuildId}/ticket`); const d=await r.json();
  document.getElementById('ticketContent').innerHTML=`
    <div class="tr"><div class="tl"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°Ø§ÙƒØ±</div></div><label class="toggle"><input type="checkbox" id="tEnabled" ${d.enabled?'checked':''}><span class="ts"></span></label></div>
    <div class="fg2" style="margin-top:14px;">
      <div class="fg"><label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„Ù„ÙˆØ­Ø©</label><select class="fs" id="tChannel">${ch('',d.channel)}</select></div>
      <div class="fg"><label class="fl">Ø§Ù„ÙƒØ§ØªÙŠØºÙˆØ±ÙŠ</label><select class="fs" id="tCat">${cat(d.category)}</select></div>
      <div class="fg"><label class="fl">Ø±ØªØ¨Ø© Ø§Ù„Ø¯Ø¹Ù…</label><select class="fs" id="tRole">${ro('',d.supportRole)}</select></div>
      <div class="fg"><label class="fl">Ø£Ù‚ØµÙ‰ ØªØ°Ø§ÙƒØ± Ù„Ù„Ø¹Ø¶Ùˆ</label><input type="number" class="fi" id="tMax" value="${d.maxTickets||1}" min="1" max="5"></div>
    </div>
    <div class="fg"><label class="fl">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ Embed</label><input type="text" class="fi" id="tTitle" value="${d.title||'ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±'}"></div>
    <div class="fg"><label class="fl">ÙˆØµÙ Ø§Ù„Ù€ Embed</label><textarea class="fta" id="tDesc">${d.description||''}</textarea></div>
    <div class="fg"><label class="fl">Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="text" class="fi" id="tBtn" value="${d.buttonText||'ğŸ“© ÙØªØ­ ØªØ°ÙƒØ±Ø©'}"></div>
    <div class="fg"><label class="fl">Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø©</label><textarea class="fta" id="tWelcome">${d.welcomeMsg||''}</textarea></div>
    <div class="save-bar"><span>Ø§Ø­ÙØ¸ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø©</span><button class="btn btn-g btn-s" onclick="toast('ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø©!','success')">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø©</button></div>
  `;
}
async function saveTicket(){
  const body={enabled:document.getElementById('tEnabled').checked,channel:document.getElementById('tChannel').value,category:document.getElementById('tCat').value,supportRole:document.getElementById('tRole').value,maxTickets:parseInt(document.getElementById('tMax').value),title:document.getElementById('tTitle').value,description:document.getElementById('tDesc').value,buttonText:document.getElementById('tBtn').value,welcomeMsg:document.getElementById('tWelcome').value};
  const r=await fetch(`/api/guild/${currentGuildId}/ticket`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ°Ø§ÙƒØ±','success'):toast('âŒ Ø®Ø·Ø£','error');
}

// ===== SUGGESTIONS =====
async function loadSuggestions(){
  const r=await fetch(`/api/guild/${currentGuildId}/suggestions`); const d=await r.json();
  document.getElementById('suggestContent').innerHTML=`
    <div class="tr"><div class="tl"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</div></div><label class="toggle"><input type="checkbox" id="sEnabled" ${d.enabled?'checked':''}><span class="ts"></span></label></div>
    <div class="fg2" style="margin-top:14px;">
      <div class="fg"><label class="fl">Ù‚Ù†Ø§Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</label><select class="fs" id="sChannel">${ch('',d.channel)}</select></div>
      <div class="fg"><label class="fl">Ù‚Ù†Ø§Ø© Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label><select class="fs" id="sStaff">${ch('',d.staffChannel)}</select></div>
    </div>
    <div class="tr"><div class="tl"><div class="name">Thread ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙƒÙ„ Ø§Ù‚ØªØ±Ø§Ø­</div><div class="desc">ÙŠÙ†Ø´Ø¦ thread Ù†Ù‚Ø§Ø´ Ù„ÙƒÙ„ Ø§Ù‚ØªØ±Ø§Ø­</div></div><label class="toggle"><input type="checkbox" id="sThread" ${d.autoThread?'checked':''}><span class="ts"></span></label></div>
  `;
}
async function saveSuggestions(){
  const body={enabled:document.getElementById('sEnabled').checked,channel:document.getElementById('sChannel').value,staffChannel:document.getElementById('sStaff').value,autoThread:document.getElementById('sThread').checked};
  const r=await fetch(`/api/guild/${currentGuildId}/suggestions`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); d.success?toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª','success'):toast('âŒ Ø®Ø·Ø£','error');
}

// ===== PREMIUM =====
async function loadPremium(){
  const r=await fetch(`/api/guild/${currentGuildId}/premium`); const d=await r.json();
  const box=document.getElementById('premStatusBox');
  if(d.premium){
    const exp=d.expiresAt?new Date(d.expiresAt).toLocaleDateString('ar-EG'):'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    box.innerHTML=`<div style="background:rgba(87,242,135,0.1);border:1px solid rgba(87,242,135,0.25);border-radius:12px;padding:14px;color:var(--green);font-weight:700;">âœ… Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…ÙØ¹Ù‘Ù„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… â€” ÙŠÙ†ØªÙ‡ÙŠ: ${exp}</div>`;
    document.getElementById('paymentSection').style.display='none';
  } else {
    box.innerHTML=`<div style="background:rgba(107,114,128,0.1);border:1px solid var(--border);border-radius:12px;padding:14px;color:var(--muted);">Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© â€” Ø§Ø´ØªØ±Ùƒ Ø¨Ù€ $1 ÙÙ‚Ø·!</div>`;
  }
}
function showPayment(){document.getElementById('paymentSection').style.display='block';document.getElementById('paymentSection').scrollIntoView({behavior:'smooth'});}

function showVodafoneInstructions(){
  openModal(`
    <h3>ğŸ“± Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</h3>
    <p style="color:var(--muted);font-size:0.88rem;margin-bottom:16px;">Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¯ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…:</p>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div style="background:var(--card2);border-radius:10px;padding:12px;display:flex;gap:10px;align-items:center;">
        <div style="width:28px;height:28px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.85rem;flex-shrink:0;">1</div>
        <div>Ø­ÙˆÙ‘Ù„ <strong>$1 (Ø­ÙˆØ§Ù„ÙŠ 50 Ø¬Ù†ÙŠÙ‡)</strong> Ø¹Ù„Ù‰ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</div>
      </div>
      <div style="background:var(--card2);border-radius:10px;padding:12px;display:flex;gap:10px;align-items:center;">
        <div style="width:28px;height:28px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.85rem;flex-shrink:0;">2</div>
        <div>Ø§Ù„Ø±Ù‚Ù…: <strong style="color:var(--accent2);font-family:'Orbitron',monospace;">+201069181060</strong> <button class="btn btn-g btn-s" onclick="copyText('+201069181060')">Ù†Ø³Ø®</button></div>
      </div>
      <div style="background:var(--card2);border-radius:10px;padding:12px;display:flex;gap:10px;align-items:center;">
        <div style="width:28px;height:28px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.85rem;flex-shrink:0;">3</div>
        <div>Ø§ÙØªØ­ ØªÙƒØª ÙÙŠ Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¯Ø¹Ù… ÙˆØ£Ø¨Ø¹Øª ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ + ID Ø³ÙŠØ±ÙØ±Ùƒ</div>
      </div>
      <div style="background:var(--card2);border-radius:10px;padding:12px;display:flex;gap:10px;align-items:center;">
        <div style="width:28px;height:28px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.85rem;flex-shrink:0;">âœ“</div>
        <div>Ù‡ÙŠØªÙØ¹Ù„ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚!</div>
      </div>
    </div>
    <div style="margin-top:16px;display:flex;gap:10px;">
      <a href="https://discord.com/channels/1440311353922555917/1447358530926547086" target="_blank" class="btn btn-p" style="flex:1;justify-content:center;">ğŸ« Ø§ÙØªØ­ ØªÙƒØª Ø¯Ø¹Ù…</a>
      <button class="btn btn-g" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  `);
}

function openTicketSupport(){window.open('https://discord.com/channels/1440311353922555917/1447358530926547086','_blank');}

// ===== ADMIN =====
async function loadAdmin(){
  if(!isAdmin)return;
  try{
    const [statsR,guildsR,premR]=await Promise.all([fetch('/api/admin/stats'),fetch('/api/admin/guilds'),fetch('/api/admin/premium/list')]);
    const statsRaw=await statsR.json(), guildsRaw=await guildsR.json(), premsRaw=await premR.json();
    // âœ… FIX: ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù€ responses ØµØ­ Ùˆmake sure arrays
    const stats = (statsRaw && !statsRaw.error) ? statsRaw : {totalGuilds:0,premiumGuilds:0,freeGuilds:0};
    const guilds = Array.isArray(guildsRaw) ? guildsRaw : [];
    const prems = Array.isArray(premsRaw) ? premsRaw : [];
    // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ø°ÙŠØ± Ù„Ùˆ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ù…Ù† Discord
    if(guildsRaw && guildsRaw.error){
      document.getElementById('adminGuildsList').innerHTML=`<div style="color:var(--red);text-align:center;padding:20px;">âš ï¸ ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„Ø¨ÙˆØª Ù…Ù† Discord. ØªØ­Ù‚Ù‚ Ù…Ù† BOT_TOKEN.</div>`;
    }
    document.getElementById('adminStats').innerHTML=`
      <div class="stat-card"><div class="stat-icon" style="background:rgba(88,101,242,0.15);">ğŸ–¥ï¸</div><div><div class="stat-num">${stats.totalGuilds}</div><div class="stat-label">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(245,167,66,0.15);">ğŸ‘‘</div><div><div class="stat-num">${stats.premiumGuilds}</div><div class="stat-label">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(107,114,128,0.15);">âš¡</div><div><div class="stat-num">${stats.freeGuilds}</div><div class="stat-label">Ù…Ø¬Ø§Ù†ÙŠ</div></div></div>
    `;
    // Build premium list with guild names from guilds list
    const guildNameMap = {};
    guilds.forEach(g => { guildNameMap[g.id] = {name:g.name, icon:g.icon}; });
    document.getElementById('premiumList').innerHTML = prems.length ? `
      <table class="admin-table">
        <tr><th>Ø§Ù„Ø³ÙŠØ±ÙØ±</th><th>ID</th><th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø£ÙØ¹Ø·ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
        ${prems.map(p=>{
          const gInfo = guildNameMap[p.guildId];
          return `<tr>
            <td style="display:flex;align-items:center;gap:8px;">
              ${gInfo?.icon?`<img src="${gInfo.icon}" style="width:24px;height:24px;border-radius:50%;">`:'<div style="width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,#5865F2,#7c3aed);display:flex;align-items:center;justify-content:center;font-size:0.7rem;">ğŸ‘‘</div>'}
              <strong>${gInfo?.name||'Ø³ÙŠØ±ÙØ± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</strong>
            </td>
            <td><code style="font-family:'Orbitron',monospace;font-size:0.7rem;color:var(--muted);">${p.guildId}</code></td>
            <td>${p.expiresAt?`<span style="color:var(--green);">${new Date(p.expiresAt).toLocaleDateString('ar-EG')}</span>`:'<span style="color:var(--muted);">Ø¯Ø§Ø¦Ù…</span>'}</td>
            <td>${p.grantedBy||'-'}</td>
            <td><button class="btn btn-d btn-s" onclick="revokePremium('${p.guildId}')">Ø³Ø­Ø¨</button></td>
          </tr>`;
        }).join('')}
      </table>` : '<div style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ±ÙØ±Ø§Øª Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
    if(guilds.length>0){
      document.getElementById('adminGuildsList').innerHTML=`<table class="admin-table"><tr><th>Ø§Ù„Ø³ÙŠØ±ÙØ±</th><th>ID</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>${guilds.map(g=>`<tr><td style="display:flex;align-items:center;gap:8px;">${g.icon?`<img src="${g.icon}" style="width:24px;height:24px;border-radius:50%;">`:''}<span>${g.name}</span></td><td style="font-family:'Orbitron',monospace;font-size:0.72rem;">${g.id}</td><td>${g.premium?'<span class="tag tag-yellow">ğŸ‘‘ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</span>':'<span class="tag" style="background:rgba(107,114,128,0.1);color:var(--muted);border:1px solid var(--border);">âš¡ Ù…Ø¬Ø§Ù†ÙŠ</span>'}</td><td>${g.premium?`<button class="btn btn-d btn-s" onclick="revokePremium('${g.id}')">Ø³Ø­Ø¨</button>`:`<button class="btn btn-green btn-s" onclick="grantPremiumDirect('${g.id}')">Ø¥Ø¹Ø·Ø§Ø¡</button>`}</td></tr>`).join('')}</table>`;
    }
  }catch(e){console.error('loadAdmin error:',e);toast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†: '+e.message,'error');}
}

function showGrantModal(){
  openModal(`
    <h3>ğŸ‘‘ Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</h3>
    <div class="fg"><label class="fl">ID Ø§Ù„Ø³ÙŠØ±ÙØ±</label><input type="text" class="fi" id="grantGuildId" placeholder="123456789012345678"></div>
    <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù… <small>(ÙØ§Ø±Øº = Ø¯Ø§Ø¦Ù…)</small></label><input type="number" class="fi" id="grantDays" placeholder="30" min="1"></div>
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button class="btn btn-gold" onclick="grantPremium()" style="flex:1;">ğŸ‘‘ Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</button>
      <button class="btn btn-g" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  `);
}

async function grantPremium(){
  const guildId=document.getElementById('grantGuildId').value.trim();
  const days=document.getElementById('grantDays').value;
  if(!guildId){toast('Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø³ÙŠØ±ÙØ±!','error');return;}
  const r=await fetch('/api/admin/premium/grant',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,days:days?parseInt(days):null})});
  const d=await r.json();
  if(d.success){toast(`âœ… ØªÙ… Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ù„Ù„Ø³ÙŠØ±ÙØ± ${guildId}`,'success');closeModal();loadAdmin();}
  else toast('âŒ '+d.error,'error');
}

async function grantPremiumDirect(guildId){
  openModal(`
    <h3>ğŸ‘‘ Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ù„Ù€ ${guildId}</h3>
    <div class="fg"><label class="fl">Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù… <small>(ÙØ§Ø±Øº = Ø¯Ø§Ø¦Ù…)</small></label><input type="number" class="fi" id="grantDays2" placeholder="30" min="1"></div>
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button class="btn btn-gold" onclick="confirmGrant('${guildId}')" style="flex:1;">ğŸ‘‘ ØªØ£ÙƒÙŠØ¯</button>
      <button class="btn btn-g" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  `);
}

async function confirmGrant(guildId){
  const days=document.getElementById('grantDays2').value;
  const r=await fetch('/api/admin/premium/grant',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,days:days?parseInt(days):null})});
  const d=await r.json();
  if(d.success){toast(`âœ… ØªÙ… Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…`,'success');closeModal();loadAdmin();}
  else toast('âŒ '+d.error,'error');
}

async function revokePremium(guildId){
  if(!confirm('Ù‡ØªØ³Ø­Ø¨ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¯Ù‡ØŸ'))return;
  const r=await fetch('/api/admin/premium/revoke',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId})});
  const d=await r.json();
  if(d.success){toast('âœ… ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…','success');loadAdmin();}
  else toast('âŒ '+d.error,'error');
}

// ===== MODAL =====
function openModal(html){document.getElementById('modalContent').innerHTML=html;document.getElementById('modalOverlay').style.display='flex';}
function closeModal(){document.getElementById('modalOverlay').style.display='none';}

// ===== TOAST =====
function toast(msg,type='success'){
  const w=document.getElementById('toastWrap');const t=document.createElement('div');t.className=`toast ${type}`;t.textContent=msg;w.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity 0.4s';setTimeout(()=>t.remove(),400);},3000);
}

// ===== UTILS =====


// ============================================================
// RANK / XP PANEL
// ============================================================
let rankSettings = {};

async function loadRank() {
  if (!isPremiumGuild) {
    document.getElementById('rankPremBadge').style.display = 'flex';
    document.getElementById('rankSettingsForm').innerHTML = `
      <div style="text-align:center;padding:30px;">
        <div style="font-size:2.5rem;margin-bottom:12px;">ğŸ‘‘</div>
        <div style="font-weight:700;font-size:1.1rem;margin-bottom:8px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª â€” Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ÙÙ‚Ø·</div>
        <div style="color:var(--muted);font-size:0.9rem;">ÙØ¹Ù‘Ù„ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… XP ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</div>
      </div>`;
    document.getElementById('rankLeaderboard').innerHTML = '';
    return;
  }

  try {
    const [settR, lbR, infoR] = await Promise.all([
      fetch('/api/guild/'+currentGuildId+'/rank/settings'),
      fetch('/api/guild/'+currentGuildId+'/rank'),
      fetch('/api/guild/'+currentGuildId+'/info')
    ]);
    rankSettings = await settR.json();
    const lbData  = await lbR.json();
    const info    = await infoR.json();

    // Fill settings
    document.getElementById('rankEnabled').checked   = rankSettings.enabled !== false;
    document.getElementById('rankXpMin').value       = rankSettings.xpMin || 5;
    document.getElementById('rankXpMax').value       = rankSettings.xpMax || 15;
    document.getElementById('rankLevelUpMsg').value  = rankSettings.levelUpMsg || 'Ù…Ø¨Ø±ÙˆÙƒ {user}! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ **{level}** ğŸ‰';

    // Fill channels
    const chSel = document.getElementById('rankLevelUpCh');
    chSel.innerHTML = '<option value="">Ø¨Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±</option>';
    (info.channels||[]).forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id; opt.textContent = '#' + c.name;
      if (c.id === rankSettings.levelUpChannel) opt.selected = true;
      chSel.appendChild(opt);
    });

    // Leaderboard
    const lb = lbData.leaderboard || [];
    document.getElementById('rankTotal').textContent = (lbData.total||0) + ' Ø¹Ø¶Ùˆ';

    if (!lb.length) {
      document.getElementById('rankLeaderboard').innerHTML = '<div style="text-align:center;padding:30px;color:var(--muted);">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ â€” Ø§Ù„Ø¨ÙˆØª ÙŠØ¬Ù…Ø¹ XP ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>';
      return;
    }

    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];

    // Ø¬Ù„Ø¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ù† guildInfo
    const memberMap = {};
    (guildInfo?.members || []).forEach(m => { memberMap[m.id] = m; });

    const rows = lb.map((u, i) => {
      const nextXp = u.level * 100;
      const prog   = Math.min(Math.floor((u.xp / nextXp) * 100), 100);
      const medal  = medals[i] || `<span style="font-weight:900;color:var(--muted);">#${i+1}</span>`;
      const memberName = memberMap[u.userId]?.username || `User ${u.userId.slice(-4)}`;
      const memberAvatar = memberMap[u.userId]?.avatar
        ? `<img src="${memberMap[u.userId].avatar}" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">`
        : `<div style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;">${memberName[0]?.toUpperCase()||'?'}</div>`;
      return `
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--card2);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;transition:all 0.2s;" onmouseover="this.style.borderColor='rgba(88,101,242,0.4)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size:1.3rem;width:30px;text-align:center;">${medal}</div>
          ${memberAvatar}
          <div style="flex:1;min-width:0;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:5px;">
              <div style="font-weight:700;font-size:0.88rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${memberName}</div>
              <div style="display:flex;gap:8px;flex-shrink:0;">
                <span style="background:rgba(88,101,242,0.12);color:var(--accent2);border:1px solid rgba(88,101,242,0.2);border-radius:999px;padding:2px 9px;font-size:0.72rem;font-weight:700;">Lv.${u.level}</span>
                <span style="background:rgba(245,167,66,0.1);color:var(--orange);border:1px solid rgba(245,167,66,0.2);border-radius:999px;padding:2px 9px;font-size:0.72rem;font-weight:700;">${u.xp} XP</span>
              </div>
            </div>
            <div style="background:rgba(255,255,255,0.05);border-radius:999px;height:5px;overflow:hidden;">
              <div style="height:100%;width:${prog}%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:999px;transition:width 0.5s ease;"></div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:3px;">
              <span style="font-size:0.65rem;color:var(--muted);">${u.xp}/${nextXp} XP</span>
              <span style="font-size:0.65rem;color:var(--muted);">${u.messages} Ø±Ø³Ø§Ù„Ø©</span>
            </div>
          </div>
          <button class="btn btn-d btn-s" style="font-size:0.65rem;padding:3px 7px;" onclick="resetUserXP('${u.userId}')">â†©ï¸</button>
        </div>`;
    }).join('');

    document.getElementById('rankLeaderboard').innerHTML = rows;
  } catch(e) {
    console.error(e);
    document.getElementById('rankLeaderboard').innerHTML = '<div style="color:var(--red);padding:20px;text-align:center;">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
  }
}

async function saveRankSettings() {
  const data = {
    enabled:      document.getElementById('rankEnabled').checked,
    xpMin:        parseInt(document.getElementById('rankXpMin').value)||5,
    xpMax:        parseInt(document.getElementById('rankXpMax').value)||15,
    levelUpChannel: document.getElementById('rankLevelUpCh').value || null,
    levelUpMsg:   document.getElementById('rankLevelUpMsg').value,
  };
  if (data.xpMin > data.xpMax) return toast('âŒ XP Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø£Ù‚ØµÙ‰!','error');
  try {
    const r = await fetch('/api/guild/'+currentGuildId+'/rank/settings', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)
    });
    const d = await r.json();
    if (d.success) toast('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª!','success');
    else toast('âŒ '+(d.error||'Ø®Ø·Ø£'),'error');
  } catch { toast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„','error'); }
}

async function resetUserXP(userId) {
  if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù XP Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶ÙˆØŸ')) return;
  try {
    const r = await fetch('/api/guild/'+currentGuildId+'/rank/reset', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({userId})
    });
    const d = await r.json();
    if (d.success) { toast('âœ… ØªÙ… Ø­Ø°Ù XP Ø§Ù„Ø¹Ø¶Ùˆ','success'); loadRank(); }
    else toast('âŒ '+(d.error||'Ø®Ø·Ø£'),'error');
  } catch { toast('âŒ Ø®Ø·Ø£','error'); }
}

async function confirmResetAllXP() {
  if (!confirm('ØªØ­Ø°ÙŠØ±! Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª XP Ù„Ù„Ø³ÙŠØ±ÙØ±. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
  try {
    const r = await fetch('/api/guild/'+currentGuildId+'/rank/reset', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({})
    });
    const d = await r.json();
    if (d.success) { toast('âœ… ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª XP','success'); loadRank(); }
    else toast('âŒ '+(d.error||'Ø®Ø·Ø£'),'error');
  } catch { toast('âŒ Ø®Ø·Ø£','error'); }
}

// ===== MOD COMMANDS =====
const MOD_COMMANDS = [
  {cmd:'ban',desc:'Ø­Ø¸Ø± Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±',usage:'!ban @user [Ø³Ø¨Ø¨]',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'unban',desc:'Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù† Ø¹Ø¶Ùˆ',usage:'!unban [UserID]',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'kick',desc:'Ø·Ø±Ø¯ Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±',usage:'!kick @user [Ø³Ø¨Ø¨]',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'mute',desc:'ÙƒØªÙ… Ø¹Ø¶Ùˆ Ù„Ù…Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©',usage:'!mute @user [Ù…Ø¯Ø©] [Ø³Ø¨Ø¨]',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'unmute',desc:'Ø±ÙØ¹ Ø§Ù„ÙƒØªÙ… Ø¹Ù† Ø¹Ø¶Ùˆ',usage:'!unmute @user',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'warn',desc:'ØªØ­Ø°ÙŠØ± Ø¹Ø¶Ùˆ ÙˆØªØ³Ø¬ÙŠÙ„Ù‡',usage:'!warn @user [Ø³Ø¨Ø¨]',cat:'ØªØ­Ø°ÙŠØ±Ø§Øª',prem:false},
  {cmd:'warns',desc:'Ø¹Ø±Ø¶ ØªØ­Ø°ÙŠØ±Ø§Øª Ø¹Ø¶Ùˆ',usage:'!warns @user',cat:'ØªØ­Ø°ÙŠØ±Ø§Øª',prem:false},
  {cmd:'clearwarns',desc:'Ø­Ø°Ù ÙƒÙ„ ØªØ­Ø°ÙŠØ±Ø§Øª Ø¹Ø¶Ùˆ',usage:'!clearwarns @user',cat:'ØªØ­Ø°ÙŠØ±Ø§Øª',prem:false},
  {cmd:'timeout',desc:'Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¶Ùˆ Ù…Ø¤Ù‚ØªØ§Ù‹ (Discord Timeout)',usage:'!timeout @user [Ù…Ø¯Ø©]',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'untimeout',desc:'Ø±ÙØ¹ Ø§Ù„Ù€ Timeout Ø¹Ù† Ø¹Ø¶Ùˆ',usage:'!untimeout @user',cat:'Ø¹Ù‚ÙˆØ¨Ø§Øª',prem:false},
  {cmd:'purge',desc:'Ø­Ø°Ù Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„',usage:'!purge [Ø¹Ø¯Ø¯]',cat:'ØªÙ†Ø¸ÙŠÙ',prem:false},
  {cmd:'slowmode',desc:'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ Slowmode ÙÙŠ Ù‚Ù†Ø§Ø©',usage:'!slowmode [Ø«ÙˆØ§Ù†ÙŠ]',cat:'Ù‚Ù†ÙˆØ§Øª',prem:false},
  {cmd:'lock',desc:'Ù‚ÙÙ„ Ù‚Ù†Ø§Ø© Ù†ØµÙŠØ©',usage:'!lock [Ù‚Ù†Ø§Ø©]',cat:'Ù‚Ù†ÙˆØ§Øª',prem:false},
  {cmd:'unlock',desc:'ÙØªØ­ Ù‚Ù†Ø§Ø© Ù…Ù‚ÙÙ„Ø©',usage:'!unlock [Ù‚Ù†Ø§Ø©]',cat:'Ù‚Ù†ÙˆØ§Øª',prem:false},
  {cmd:'lockall',desc:'Ù‚ÙÙ„ ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª (Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦)',usage:'!lockall',cat:'Ù‚Ù†ÙˆØ§Øª',prem:true},
  {cmd:'unlockall',desc:'ÙØªØ­ ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª',usage:'!unlockall',cat:'Ù‚Ù†ÙˆØ§Øª',prem:true},
  {cmd:'addrole',desc:'Ø¥Ø¹Ø·Ø§Ø¡ Ø±ØªØ¨Ø© Ù„Ø¹Ø¶Ùˆ',usage:'!addrole @user @role',cat:'Ø±ØªØ¨',prem:false},
  {cmd:'removerole',desc:'Ø³Ø­Ø¨ Ø±ØªØ¨Ø© Ù…Ù† Ø¹Ø¶Ùˆ',usage:'!removerole @user @role',cat:'Ø±ØªØ¨',prem:false},
  {cmd:'nick',desc:'ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø¹Ø¶Ùˆ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±',usage:'!nick @user [Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯]',cat:'Ø¥Ø¯Ø§Ø±Ø©',prem:false},
  {cmd:'announce',desc:'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª',usage:'!announce #Ù‚Ù†Ø§Ø© [Ù†Øµ]',cat:'Ø¥Ø¯Ø§Ø±Ø©',prem:true},
];

const GEN_COMMANDS = [
  {cmd:'help',desc:'Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©',usage:'!help [Ø£Ù…Ø±]',cat:'Ø¹Ø§Ù…',prem:false},
  {cmd:'ping',desc:'Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¨ÙˆØª',usage:'!ping',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'info',desc:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù† Ø§Ù„Ø¨ÙˆØª',usage:'!info',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'serverinfo',desc:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø©',usage:'!serverinfo',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'userinfo',desc:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø© Ø¹Ù† Ø¹Ø¶Ùˆ',usage:'!userinfo [@user]',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'avatar',desc:'Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©',usage:'!avatar [@user]',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'roleinfo',desc:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø±ØªØ¨Ø© Ù…Ø¹ÙŠÙ†Ø©',usage:'!roleinfo @role',cat:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',prem:false},
  {cmd:'rank',desc:'Ø¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ ÙˆXP Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ',usage:'!rank [@user]',cat:'Ù…Ø³ØªÙˆÙŠØ§Øª',prem:true},
  {cmd:'leaderboard',desc:'Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±',usage:'!leaderboard',cat:'Ù…Ø³ØªÙˆÙŠØ§Øª',prem:true},
  {cmd:'afk',desc:'ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ AFK',usage:'!afk [Ø³Ø¨Ø¨]',cat:'Ø¹Ø§Ù…',prem:false},
  {cmd:'report',desc:'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¹Ø¶Ùˆ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©',usage:'!report @user [Ø³Ø¨Ø¨]',cat:'Ø¹Ø§Ù…',prem:false},
  {cmd:'suggest',desc:'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­ Ù„Ù„Ø³ÙŠØ±ÙØ±',usage:'!suggest [Ø§Ù‚ØªØ±Ø§Ø­Ùƒ]',cat:'Ù…Ø¬ØªÙ…Ø¹',prem:false},
  {cmd:'poll',desc:'Ø¥Ù†Ø´Ø§Ø¡ ØªØµÙˆÙŠØª',usage:'!poll [Ø³Ø¤Ø§Ù„] | [Ø®ÙŠØ§Ø±1] | [Ø®ÙŠØ§Ø±2]',cat:'Ù…Ø¬ØªÙ…Ø¹',prem:false},
  {cmd:'giveaway',desc:'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø©',usage:'!giveaway [Ù…Ø¯Ø©] [Ø¬Ø§Ø¦Ø²Ø©]',cat:'Ù…Ø¬ØªÙ…Ø¹',prem:true},
  {cmd:'8ball',desc:'Ø³Ø¤Ø§Ù„ Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ©',usage:'!8ball [Ø³Ø¤Ø§Ù„Ùƒ]',cat:'ØªØ±ÙÙŠÙ‡',prem:false},
  {cmd:'flip',desc:'Ø±Ù…ÙŠ Ø¹Ù…Ù„Ø© (ØµÙˆØ±Ø©/ÙƒØªØ§Ø¨Ø©)',usage:'!flip',cat:'ØªØ±ÙÙŠÙ‡',prem:false},
  {cmd:'roll',desc:'Ø±Ù…ÙŠ Ù†Ø±Ø¯ Ø¨Ø±Ù‚Ù… Ù…Ø­Ø¯Ø¯',usage:'!roll [Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ¬Ù‡]',cat:'ØªØ±ÙÙŠÙ‡',prem:false},
  {cmd:'play',desc:'ØªØ´ØºÙŠÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙÙŠ Ù‚Ù†Ø§Ø© ØµÙˆØªÙŠØ©',usage:'!play [Ø§Ø³Ù…/Ø±Ø§Ø¨Ø·]',cat:'Ù…ÙˆØ³ÙŠÙ‚Ù‰',prem:true},
  {cmd:'skip',desc:'ØªØ®Ø·ÙŠ Ø§Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',usage:'!skip',cat:'Ù…ÙˆØ³ÙŠÙ‚Ù‰',prem:true},
  {cmd:'queue',desc:'Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØºØ§Ù†ÙŠ Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø©',usage:'!queue',cat:'Ù…ÙˆØ³ÙŠÙ‚Ù‰',prem:true},
];

const CAT_COLORS = {
  'Ø¹Ù‚ÙˆØ¨Ø§Øª':'rgba(237,66,69,0.1);color:var(--red);border-color:rgba(237,66,69,0.3)',
  'ØªØ­Ø°ÙŠØ±Ø§Øª':'rgba(254,231,92,0.1);color:var(--yellow);border-color:rgba(254,231,92,0.3)',
  'ØªÙ†Ø¸ÙŠÙ':'rgba(0,212,255,0.1);color:var(--accent2);border-color:rgba(0,212,255,0.3)',
  'Ù‚Ù†ÙˆØ§Øª':'rgba(88,101,242,0.1);color:var(--accent);border-color:rgba(88,101,242,0.3)',
  'Ø±ØªØ¨':'rgba(124,58,237,0.1);color:#a78bfa;border-color:rgba(124,58,237,0.3)',
  'Ø¥Ø¯Ø§Ø±Ø©':'rgba(87,242,135,0.1);color:var(--green);border-color:rgba(87,242,135,0.3)',
  'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª':'rgba(0,212,255,0.1);color:var(--accent2);border-color:rgba(0,212,255,0.3)',
  'Ù…Ø³ØªÙˆÙŠØ§Øª':'rgba(245,167,66,0.1);color:var(--orange);border-color:rgba(245,167,66,0.3)',
  'Ù…Ø¬ØªÙ…Ø¹':'rgba(87,242,135,0.1);color:var(--green);border-color:rgba(87,242,135,0.3)',
  'ØªØ±ÙÙŠÙ‡':'rgba(124,58,237,0.1);color:#a78bfa;border-color:rgba(124,58,237,0.3)',
  'Ù…ÙˆØ³ÙŠÙ‚Ù‰':'rgba(245,167,66,0.1);color:var(--orange);border-color:rgba(245,167,66,0.3)',
  'Ø¹Ø§Ù…':'rgba(107,114,128,0.1);color:var(--muted);border-color:var(--border)',
};

// Custom commands overrides loaded from server
let customCmdsData = {};

function getDisplayName(c) {
  const over = customCmdsData[c.cmd];
  return over?.name || c.cmd;
}
function getDisplayDesc(c) {
  const over = customCmdsData[c.cmd];
  return over?.desc || c.desc;
}

function renderCmds(cmds, containerId, prefix='!') {
  const container = document.getElementById(containerId);
  if(!container) return;
  container.innerHTML = cmds.map(c => {
    const catStyle = CAT_COLORS[c.cat] || CAT_COLORS['Ø¹Ø§Ù…'];
    const displayName = getDisplayName(c);
    const displayDesc = getDisplayDesc(c);
    const isCustomized = customCmdsData[c.cmd]?.name || customCmdsData[c.cmd]?.desc;
    const usage = c.usage.replace('!' + c.cmd, prefix + displayName);
    return `
    <div class="cmd-card" id="cmdcard-${c.cmd}">
      ${c.prem ? '<div class="cmd-badge cmd-badge-prem">ğŸ‘‘ Premium</div>' : ''}
      ${isCustomized ? '<div class="cmd-badge" style="top:10px;right:10px;background:rgba(87,242,135,0.15);color:var(--green);border:1px solid rgba(87,242,135,0.3);font-size:0.6rem;font-weight:900;padding:2px 7px;border-radius:999px;">âœï¸ Ù…Ø®ØµØµ</div>' : ''}
      <div id="cmdview-${c.cmd}">
        <div class="cmd-name" style="margin-top:${c.prem||isCustomized?'22px':'0'}">âŒ¨ï¸ ${prefix}${displayName}</div>
        <div class="cmd-desc" style="margin-top:5px;">${displayDesc}</div>
        <div class="cmd-usage">${usage}</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px;">
          <span class="cmd-cat" style="background:${catStyle};">${c.cat}</span>
          <button class="btn btn-g btn-s" style="font-size:0.72rem;padding:4px 9px;" onclick="showEditCmd('${c.cmd}','${containerId}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        </div>
      </div>
      <div id="cmdedit-${c.cmd}" style="display:none;">
        <div class="fg" style="margin-bottom:10px;margin-top:${c.prem?'22px':'4px'}">
          <label class="fl" style="font-size:0.78rem;">Ø§Ø³Ù… Ø§Ù„Ø£Ù…Ø± <small style="color:var(--muted);">(Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø³Ù„Ø§Ø´)</small></label>
          <div style="display:flex;gap:7px;align-items:center;">
            <span style="color:var(--muted);font-family:'Orbitron',monospace;font-size:0.85rem;">${prefix}</span>
            <input type="text" class="fi" id="cmdinput-${c.cmd}"
              value="${displayName}"
              placeholder="${c.cmd}"
              style="font-family:'Orbitron',monospace;font-size:0.8rem;"
              oninput="this.value=this.value.replace(/[\\s\\/]/g,'')">
          </div>
        </div>
        <div class="fg" style="margin-bottom:10px;">
          <label class="fl" style="font-size:0.78rem;">ÙˆØµÙ Ø§Ù„Ø£Ù…Ø±</label>
          <input type="text" class="fi" id="cmddesc-${c.cmd}"
            value="${displayDesc}"
            placeholder="${c.desc}"
            style="font-size:0.83rem;">
        </div>
        <div style="display:flex;gap:7px;">
          <button class="btn btn-p btn-s" style="flex:1;justify-content:center;" onclick="saveEditCmd('${c.cmd}','${c.desc}','${containerId}')">ğŸ’¾ Ø­ÙØ¸</button>
          ${isCustomized ? `<button class="btn btn-d btn-s" onclick="resetCmd('${c.cmd}','${c.cmd}','${c.desc}','${containerId}')">â†©ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>` : ''}
          <button class="btn btn-g btn-s" onclick="cancelEditCmd('${c.cmd}')">âœ•</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function showEditCmd(cmdKey, containerId) {
  document.getElementById('cmdview-' + cmdKey).style.display = 'none';
  document.getElementById('cmdedit-' + cmdKey).style.display = 'block';
  document.getElementById('cmdinput-' + cmdKey).focus();
}

function cancelEditCmd(cmdKey) {
  document.getElementById('cmdview-' + cmdKey).style.display = 'block';
  document.getElementById('cmdedit-' + cmdKey).style.display = 'none';
}

async function saveEditCmd(cmdKey, origDesc, containerId) {
  const newName = document.getElementById('cmdinput-' + cmdKey).value.trim();
  const newDesc = document.getElementById('cmddesc-' + cmdKey).value.trim();
  if(!newName) { toast('Ø§Ø³Ù… Ø§Ù„Ø£Ù…Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹!','error'); return; }
  if(newName.includes(' ') || newName.includes('/')) { toast('âŒ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø³Ù„Ø§Ø´','error'); return; }
  if(newName.length > 32) { toast('âŒ Ø§Ù„Ø§Ø³Ù… Ø£ÙƒØ«Ø± Ù…Ù† 32 Ø­Ø±Ù','error'); return; }
  try {
    const r = await fetch(`/api/guild/${currentGuildId}/custom-cmds`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({cmdKey, newName, newDesc: newDesc||origDesc})
    });
    const d = await r.json();
    if(d.success) {
      customCmdsData[cmdKey] = {name: newName, desc: newDesc||origDesc};
      // re-render just this card by refreshing whole grid
      const allCmds = containerId === 'modCmdsGrid' ? MOD_COMMANDS : GEN_COMMANDS;
      const prefix = document.getElementById('cmdinput-' + cmdKey)?.closest('.cmd-card')?.querySelector('.cmd-name')?.textContent?.charAt(0) || currentPrefix||'!';
      renderCmds(allCmds, containerId, currentPrefix||'!');
      toast('âœ… ØªÙ… Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù…Ø±!', 'success');
    } else { toast('âŒ ' + (d.error||'Ø®Ø·Ø£'), 'error'); }
  } catch { toast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„','error'); }
}

async function resetCmd(cmdKey, origName, origDesc, containerId) {
  try {
    await fetch(`/api/guild/${currentGuildId}/custom-cmds/${cmdKey}`, {method:'DELETE'});
    delete customCmdsData[cmdKey];
    const allCmds = containerId === 'modCmdsGrid' ? MOD_COMMANDS : GEN_COMMANDS;
    renderCmds(allCmds, containerId, currentPrefix||'!');
    toast('â†©ï¸ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ','info');
  } catch { toast('âŒ Ø®Ø·Ø£','error'); }
}

let currentPrefix = '!';
let modCmdsLoaded = false, genCmdsLoaded = false;

async function loadCmdsBase() {
  try {
    const [prefixR, customR] = await Promise.all([
      fetch(`/api/guild/${currentGuildId}/prefix`),
      fetch(`/api/guild/${currentGuildId}/custom-cmds`)
    ]);
    const prefixD = await prefixR.json();
    currentPrefix = prefixD.prefix || '!';
    customCmdsData = await customR.json();
  } catch { currentPrefix='!'; customCmdsData={}; }
}

async function loadModCmds() {
  modCmdsLoaded = false;
  await loadCmdsBase();
  const panel = document.getElementById('panel-mod_cmds');
  const card = panel.querySelector('.card');
  // Add search if not present
  let searchEl = document.getElementById('modCmdsSearch');
  if(!searchEl) {
    searchEl = document.createElement('input');
    searchEl.type='text'; searchEl.className='cmds-search'; searchEl.id='modCmdsSearch';
    searchEl.placeholder='ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù…Ø± Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙˆØµÙ...';
    searchEl.oninput = () => {
      const q = searchEl.value.toLowerCase();
      const filtered = q ? MOD_COMMANDS.filter(c=>c.cmd.includes(q)||getDisplayName(c).includes(q)||c.desc.includes(q)) : MOD_COMMANDS;
      renderCmds(filtered, 'modCmdsGrid', currentPrefix);
    };
    card.insertBefore(searchEl, document.getElementById('modCmdsGrid'));
  }
  renderCmds(MOD_COMMANDS, 'modCmdsGrid', currentPrefix);
  modCmdsLoaded = true;
}

async function loadGenCmds() {
  genCmdsLoaded = false;
  await loadCmdsBase();
  const panel = document.getElementById('panel-gen_cmds');
  const card = panel.querySelector('.card');
  let searchEl = document.getElementById('genCmdsSearch');
  if(!searchEl) {
    searchEl = document.createElement('input');
    searchEl.type='text'; searchEl.className='cmds-search'; searchEl.id='genCmdsSearch';
    searchEl.placeholder='ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù…Ø± Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙˆØµÙ...';
    searchEl.oninput = () => {
      const q = searchEl.value.toLowerCase();
      const filtered = q ? GEN_COMMANDS.filter(c=>c.cmd.includes(q)||getDisplayName(c).includes(q)||c.desc.includes(q)) : GEN_COMMANDS;
      renderCmds(filtered, 'genCmdsGrid', currentPrefix);
    };
    card.insertBefore(searchEl, document.getElementById('genCmdsGrid'));
  }
  renderCmds(GEN_COMMANDS, 'genCmdsGrid', currentPrefix);
  genCmdsLoaded = true;
}

// ===== LEVELS SYSTEM =====
async function loadLevels() {
  await loadGuildInfo();
  try {
    const [cfgR, lbR] = await Promise.all([
      fetch(`/api/guild/${currentGuildId}/levels`),
      fetch(`/api/guild/${currentGuildId}/levels/leaderboard`)
    ]);
    const cfg = await cfgR.json();
    const lb  = await lbR.json();

    document.getElementById('lvlEnabled').checked = cfg.enabled||false;
    document.getElementById('lvlMessage').value   = cfg.message||'Ù…Ø¨Ø±ÙˆÙƒ {user}! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ {level} ğŸ‰';
    document.getElementById('lvlMinXp').value      = cfg.minXp||5;
    document.getElementById('lvlMaxXp').value      = cfg.maxXp||15;
    document.getElementById('lvlMultiplier').value = cfg.multiplier||2;

    // fill channel selects
    const chSel = document.getElementById('lvlChannel');
    const igSel = document.getElementById('lvlIgnoredChannels');
    chSel.innerHTML = '<option value="">Ø¨Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</option>';
    igSel.innerHTML = '';
    guildChannels.forEach(c => {
      chSel.innerHTML += `<option value="${c.id}" ${cfg.channel===c.id?'selected':''}>#${c.name}</option>`;
      igSel.innerHTML += `<option value="${c.id}" ${(cfg.ignoredChannels||[]).includes(c.id)?'selected':''}>#${c.name}</option>`;
    });

    // leaderboard
    const lbEl = document.getElementById('lvlLeaderboard');
    if (!lb.length) { lbEl.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ â€” Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙŠØ­ØªØ§Ø¬ÙˆÙ† ÙŠØ¨Ø¹ØªÙˆØ§ Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ„!</p>'; return; }
    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    lbEl.innerHTML = `<div style="display:flex;flex-direction:column;gap:8px;">${lb.slice(0,10).map((u,i)=>`
      <div style="display:flex;align-items:center;gap:12px;background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:12px;">
        <div style="font-size:1.3rem;width:30px;text-align:center;">${medals[i]||`#${i+1}`}</div>
        <img src="${u.avatar||'https://cdn.discordapp.com/embed/avatars/0.png'}" style="width:36px;height:36px;border-radius:50%;" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
        <div style="flex:1;">
          <div style="font-weight:700;font-size:0.9rem;">${u.username||u.userId}</div>
          <div style="color:var(--muted);font-size:0.78rem;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${u.level} â€” ${u.xp} XP â€” ${u.messages} Ø±Ø³Ø§Ù„Ø©</div>
        </div>
        <div style="background:linear-gradient(135deg,rgba(245,167,66,0.15),rgba(254,231,92,0.08));border:1px solid rgba(245,167,66,0.3);border-radius:8px;padding:4px 12px;font-size:0.8rem;font-weight:700;color:var(--orange);">Lv.${u.level}</div>
      </div>`).join('')}</div>`;
  } catch(e) { console.error(e); toast('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª','error'); }
}

async function saveLevels() {
  const ignoredChs = Array.from(document.getElementById('lvlIgnoredChannels').selectedOptions).map(o=>o.value);
  const body = {
    enabled:    document.getElementById('lvlEnabled').checked,
    channel:    document.getElementById('lvlChannel').value || null,
    message:    document.getElementById('lvlMessage').value,
    minXp:      parseInt(document.getElementById('lvlMinXp').value)||5,
    maxXp:      parseInt(document.getElementById('lvlMaxXp').value)||15,
    multiplier: parseFloat(document.getElementById('lvlMultiplier').value)||2,
    ignoredChannels: ignoredChs,
  };
  const r = await fetch(`/api/guild/${currentGuildId}/levels`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
  const d = await r.json();
  d.success ? toast('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª!','success') : toast('âŒ Ø®Ø·Ø£: '+d.error,'error');
}

// ===== RANK ROLES =====
async function loadRankRoles() {
  await loadGuildInfo();
  try {
    const r = await fetch(`/api/guild/${currentGuildId}/rankroles`);
    const data = await r.json();

    // fill role select
    const roleSel = document.getElementById('rrRole');
    roleSel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø±ØªØ¨Ø©</option>';
    guildRoles.forEach(ro => roleSel.innerHTML += `<option value="${ro.id}">@${ro.name}</option>`);

    renderRankRoles(data);
  } catch(e) { toast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„','error'); }
}

function renderRankRoles(list) {
  const el = document.getElementById('rankRolesList');
  if (!list.length) {
    el.innerHTML = '<p style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ØªØ¨ Ù…Ø³ØªÙˆÙ‰ â€” Ø£Ø¶Ù ÙˆØ§Ø­Ø¯Ø© Ø£Ø¹Ù„Ø§Ù‡ â¬†ï¸</p>';
    return;
  }
  const sorted = [...list].sort((a,b)=>a.level-b.level);
  el.innerHTML = `<table class="admin-table">
    <tr><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th>Ø§Ù„Ø±ØªØ¨Ø©</th><th>Ø­Ø°Ù</th></tr>
    ${sorted.map(rr=>`<tr>
      <td><span style="background:rgba(245,167,66,0.1);color:var(--orange);border:1px solid rgba(245,167,66,0.3);border-radius:8px;padding:2px 10px;font-weight:700;">Lv.${rr.level}</span></td>
      <td><span style="color:var(--accent2);">@${rr.roleName||rr.roleId}</span></td>
      <td><button class="btn btn-d btn-s" onclick="deleteRankRole(${rr.level})">ğŸ—‘ï¸</button></td>
    </tr>`).join('')}
  </table>`;
}

async function addRankRole() {
  const level  = parseInt(document.getElementById('rrLevel').value);
  const roleId = document.getElementById('rrRole').value;
  if (!level || !roleId) return toast('âŒ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ø±ØªØ¨Ø©','error');
  const roleName = document.getElementById('rrRole').options[document.getElementById('rrRole').selectedIndex].text.replace('@','');
  const r = await fetch(`/api/guild/${currentGuildId}/rankroles`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({level, roleId, roleName})
  });
  const d = await r.json();
  if (d.success) {
    toast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰!','success');
    document.getElementById('rrLevel').value='';
    document.getElementById('rrRole').value='';
    renderRankRoles(d.list);
  } else toast('âŒ '+d.error,'error');
}

async function deleteRankRole(level) {
  const r = await fetch(`/api/guild/${currentGuildId}/rankroles/${level}`, {method:'DELETE'});
  const d = await r.json();
  if (d.success) { toast('ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù','info'); renderRankRoles(d.list); }
}

function addBot(guildId) {
  // Ù†Ø±ÙˆØ­ Ù„Ù„Ù€ route Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ¶ÙŠÙ Ø§Ù„Ø¨ÙˆØª ÙˆØ¨Ø¹Ø¯ÙŠÙ† ÙŠØ±Ø¬Ø¹ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
  window.location.href = `/auth/add-bot/${guildId}`;
}

function copyText(txt){navigator.clipboard.writeText(txt).then(()=>toast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®','success'));}
</script>
</body>
</html>
