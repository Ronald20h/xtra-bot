<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xtra System | Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#060614;--surface:#0b0b20;--card:#0f0f28;--card2:#13132e;--border:rgba(88,101,242,0.18);--accent:#5865F2;--accent2:#00d4ff;--accent3:#7c3aed;--green:#57f287;--red:#ed4245;--yellow:#fee75c;--orange:#f5a742;--text:#e8eaf6;--muted:#6b7280;--glow:rgba(88,101,242,0.35);--sidebar-w:260px;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}
::-webkit-scrollbar{width:5px;height:5px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px;}
.bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(88,101,242,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(88,101,242,0.04) 1px,transparent 1px);background-size:40px 40px;z-index:0;pointer-events:none;}

/* SERVERS PAGE */
#serversPage{display:none;min-height:100vh;padding:40px 20px;position:relative;z-index:1;}
.servers-header{text-align:center;margin-bottom:40px;}
.servers-header h1{font-family:'Orbitron',monospace;font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;}
.servers-header p{color:var(--muted);}
.user-bar{display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:30px;}
.user-av{width:40px;height:40px;border-radius:50%;border:2px solid var(--accent);}
.user-av-placeholder{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent3));display:flex;align-items:center;justify-content:center;font-weight:700;border:2px solid var(--accent);}
.servers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:18px;max-width:1100px;margin:0 auto;}
.server-card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:24px;text-align:center;transition:all 0.3s;position:relative;overflow:hidden;}
.server-card:hover{border-color:rgba(88,101,242,0.5);transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,0.3);}
.server-icon{width:65px;height:65px;border-radius:50%;margin:0 auto 12px;object-fit:cover;border:2px solid var(--border);}
.server-icon-placeholder{width:65px;height:65px;border-radius:50%;margin:0 auto 12px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;font-weight:900;border:2px solid var(--border);}
.server-name{font-weight:700;font-size:0.95rem;margin-bottom:5px;}
.server-members{color:var(--muted);font-size:0.82rem;margin-bottom:14px;}
.badge-premium{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;font-size:0.65rem;font-weight:900;padding:3px 8px;border-radius:999px;}
.badge-bot{display:inline-flex;align-items:center;gap:4px;font-size:0.78rem;padding:3px 10px;border-radius:999px;margin-bottom:12px;}
.badge-bot.active{background:rgba(87,242,135,0.12);color:var(--green);border:1px solid rgba(87,242,135,0.3);}
.badge-bot.inactive{background:rgba(107,114,128,0.12);color:var(--muted);border:1px solid rgba(107,114,128,0.2);}
.btn-manage{display:block;padding:10px;background:linear-gradient(135deg,var(--accent),var(--accent3));border-radius:10px;color:white;font-family:'Tajawal',sans-serif;font-weight:700;font-size:0.88rem;border:none;cursor:pointer;width:100%;transition:all 0.3s;text-decoration:none;}
.btn-manage:hover{transform:scale(1.02);box-shadow:0 6px 20px var(--glow);}
.btn-add{display:block;padding:10px;background:transparent;border:2px solid var(--border);border-radius:10px;color:var(--muted);font-family:'Tajawal',sans-serif;font-weight:700;font-size:0.88rem;cursor:pointer;width:100%;transition:all 0.3s;text-decoration:none;text-align:center;}
.btn-add:hover{border-color:var(--accent);color:var(--accent2);}

/* DASHBOARD */
#dashPage{display:none;min-height:100vh;}
.sidebar{position:fixed;top:0;right:0;width:var(--sidebar-w);height:100vh;background:var(--surface);border-left:1px solid var(--border);z-index:100;display:flex;flex-direction:column;overflow-y:auto;}
.sidebar-logo{padding:22px 18px;border-bottom:1px solid var(--border);}
.logo{font-family:'Orbitron',monospace;font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sidebar-server{display:flex;align-items:center;gap:10px;padding:14px 18px;border-bottom:1px solid var(--border);cursor:pointer;}
.sidebar-server:hover{background:rgba(88,101,242,0.05);}
.sidebar-server-icon{width:34px;height:34px;border-radius:8px;object-fit:cover;flex-shrink:0;}
.sidebar-server-icon-ph{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:0.9rem;font-weight:700;flex-shrink:0;}
.sidebar-server-info{flex:1;overflow:hidden;}
.sidebar-server-name{font-size:0.85rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.sidebar-server-change{font-size:0.7rem;color:var(--muted);}
.sidebar-nav{flex:1;padding:14px 10px;}
.nav-section{color:var(--muted);font-size:0.68rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:8px 10px;margin-top:8px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:11px;cursor:pointer;transition:all 0.2s;color:var(--muted);font-size:0.88rem;font-weight:500;}
.nav-item:hover{background:rgba(88,101,242,0.08);color:var(--text);}
.nav-item.active{background:linear-gradient(135deg,rgba(88,101,242,0.22),rgba(124,58,237,0.12));color:var(--accent2);border:1px solid rgba(88,101,242,0.18);}
.nav-item .icon{font-size:1rem;width:20px;text-align:center;}
.nav-premium-item{background:linear-gradient(135deg,rgba(245,167,66,0.12),rgba(254,231,92,0.06));color:#f5a742;border:1px solid rgba(245,167,66,0.18);}
.sidebar-user{padding:14px 18px;border-top:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.sidebar-av{width:32px;height:32px;border-radius:50%;object-fit:cover;}
.sidebar-av-ph{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent3));display:flex;align-items:center;justify-content:center;font-size:0.8rem;font-weight:700;}
.sidebar-uname{font-size:0.82rem;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-logout{background:none;border:none;color:var(--muted);cursor:pointer;font-size:1rem;}
.btn-logout:hover{color:var(--red);}

.main{margin-right:var(--sidebar-w);min-height:100vh;padding:28px 32px;position:relative;z-index:1;}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
.page-title{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:900;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.plan-badge{padding:7px 14px;border-radius:999px;font-size:0.8rem;font-weight:700;}
.plan-free{background:rgba(107,114,128,0.15);border:1px solid rgba(107,114,128,0.2);color:var(--muted);}
.plan-premium{background:linear-gradient(135deg,rgba(245,167,66,0.2),rgba(254,231,92,0.1));border:1px solid rgba(245,167,66,0.4);color:#f5a742;}

/* PANELS */
.panel{display:none;animation:fadeUp 0.3s ease;}
.panel.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}

/* CARDS */
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:20px;}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.card-header h3{font-weight:700;font-size:1rem;display:flex;align-items:center;gap:8px;}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:22px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;display:flex;align-items:center;gap:14px;}
.stat-icon{width:44px;height:44px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
.stat-num{font-family:'Orbitron',monospace;font-size:1.5rem;font-weight:900;}
.stat-label{color:var(--muted);font-size:0.82rem;}

/* TOGGLE */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:13px 0;border-bottom:1px solid var(--border);}
.toggle-row:last-child{border-bottom:none;}
.toggle-label .name{font-weight:600;font-size:0.92rem;}
.toggle-label .desc{color:var(--muted);font-size:0.8rem;margin-top:2px;}
.toggle{position:relative;width:44px;height:23px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:rgba(107,114,128,0.35);border-radius:999px;cursor:pointer;transition:all 0.3s;}
.toggle-slider::before{content:'';position:absolute;width:17px;height:17px;background:white;border-radius:50%;top:3px;right:3px;transition:all 0.3s;}
.toggle input:checked+.toggle-slider{background:linear-gradient(135deg,var(--accent),var(--accent3));}
.toggle input:checked+.toggle-slider::before{right:auto;left:3px;}

/* FORM */
.form-group{margin-bottom:18px;}
.form-label{display:block;font-size:0.88rem;font-weight:600;margin-bottom:7px;}
.form-label small{color:var(--muted);font-weight:400;}
.form-input,.form-select,.form-textarea{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:11px 14px;color:var(--text);font-family:'Tajawal',sans-serif;font-size:0.92rem;outline:none;transition:all 0.3s;}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(88,101,242,0.12);}
.form-select option{background:var(--card2);}
.form-textarea{min-height:90px;resize:vertical;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}

/* BUTTONS */
.btn{padding:9px 20px;border-radius:10px;font-family:'Tajawal',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;border:none;transition:all 0.25s;display:inline-flex;align-items:center;gap:7px;}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent3));color:white;box-shadow:0 4px 18px var(--glow);}
.btn-primary:hover{transform:translateY(-2px);}
.btn-danger{background:rgba(237,66,69,0.12);color:var(--red);border:1px solid rgba(237,66,69,0.25);}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
.btn-ghost:hover{border-color:var(--accent);color:var(--text);}
.btn-sm{padding:6px 13px;font-size:0.8rem;}
.btn-gold{background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(245,167,66,0.4);}

.save-bar{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:rgba(88,101,242,0.08);border:1px solid rgba(88,101,242,0.18);border-radius:12px;margin-top:20px;}
.save-bar span{color:var(--muted);font-size:0.85rem;}

/* AR */
.ar-list{display:flex;flex-direction:column;gap:10px;margin-bottom:16px;}
.ar-item{background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:14px;display:flex;gap:10px;align-items:center;}
.ar-trigger{background:rgba(0,212,255,0.1);color:var(--accent2);padding:3px 10px;border-radius:7px;font-size:0.78rem;font-weight:600;white-space:nowrap;flex-shrink:0;}
.ar-response{color:var(--muted);font-size:0.85rem;flex:1;}
.ar-del{background:none;border:none;color:var(--red);cursor:pointer;font-size:1rem;flex-shrink:0;}

/* LOGS GRID */
.logs-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.log-item{background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:14px;display:flex;justify-content:space-between;align-items:center;font-size:0.88rem;font-weight:600;}

/* PREMIUM */
.plans-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px;}
.plan-card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:28px;text-align:center;}
.plan-card.featured{border-color:rgba(245,167,66,0.4);background:linear-gradient(135deg,var(--card),rgba(245,167,66,0.04));}
.plan-name{font-family:'Orbitron',monospace;font-size:1.1rem;font-weight:900;margin-bottom:6px;}
.plan-price{font-size:2.2rem;font-weight:900;margin:14px 0 5px;}
.plan-price span{font-size:0.9rem;color:var(--muted);}
.plan-features{list-style:none;text-align:right;margin:16px 0;display:flex;flex-direction:column;gap:8px;}
.plan-features li{display:flex;align-items:center;gap:7px;font-size:0.85rem;}
.plan-features li.yes{color:var(--text);}
.plan-features li.yes::before{content:'âœ“';color:var(--green);font-weight:700;}
.plan-features li.no{color:var(--muted);}
.plan-features li.no::before{content:'âœ•';color:var(--red);}

/* TOAST */
.toast-wrap{position:fixed;bottom:24px;left:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;}
.toast{background:var(--card);border:1px solid var(--border);border-radius:11px;padding:12px 18px;display:flex;align-items:center;gap:8px;font-size:0.88rem;font-weight:500;box-shadow:0 8px 25px rgba(0,0,0,0.3);animation:toastIn 0.3s ease;max-width:300px;}
.toast.success{border-color:rgba(87,242,135,0.3);color:var(--green);}
.toast.error{border-color:rgba(237,66,69,0.3);color:var(--red);}
@keyframes toastIn{from{opacity:0;transform:translateX(-15px);}to{opacity:1;transform:translateX(0);}}

/* LOADING */
.loading{display:flex;align-items:center;justify-content:center;padding:60px;color:var(--muted);}
.spinner{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;margin-left:12px;}
@keyframes spin{to{transform:rotate(360deg);}}

@media(max-width:900px){
  .sidebar{transform:translateX(100%);transition:transform 0.3s;}.sidebar.open{transform:translateX(0);}
  .main{margin-right:0;padding:16px;}
  .plans-grid,.form-grid,.logs-grid{grid-template-columns:1fr;}
  .mobile-btn{display:flex;position:fixed;top:14px;right:14px;z-index:200;background:var(--card);border:1px solid var(--border);border-radius:9px;padding:9px;cursor:pointer;font-size:1.1rem;}
}
</style>
</head>
<body>
<div class="bg-grid"></div>
<div class="toast-wrap" id="toastWrap"></div>

<!-- SERVERS PAGE -->
<div id="serversPage">
  <div class="servers-header">
    <div class="user-bar" id="userBar">
      <div class="loading"><div class="spinner"></div></div>
    </div>
    <h1>âš¡ Ø§Ø®ØªØ± Ø³ÙŠØ±ÙØ±Ùƒ</h1>
    <p>Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§</p>
  </div>
  <div class="servers-grid" id="serversGrid">
    <div class="loading" style="grid-column:1/-1;"><div class="spinner"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashPage">
  <button class="mobile-btn" id="mobileBtn" style="display:none;" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button>
  
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo"><div class="logo">âš¡ XTRA SYSTEM</div></div>
    <div class="sidebar-server" id="sidebarServer" onclick="goServers()">
      <div class="sidebar-server-icon-ph" id="sidebarIcon" style="background:linear-gradient(135deg,#5865F2,#7c3aed);">âš¡</div>
      <div class="sidebar-server-info">
        <div class="sidebar-server-name" id="sidebarName">Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
        <div class="sidebar-server-change">â† ØªØºÙŠÙŠØ± Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
      </div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">Ø¹Ø§Ù…</div>
      <div class="nav-item active" onclick="showPanel('overview',this)"><span class="icon">ğŸ“Š</span> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="nav-section">Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
      <div class="nav-item" onclick="showPanel('protection',this)"><span class="icon">ğŸ›¡ï¸</span> Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
      <div class="nav-item" onclick="showPanel('logs',this)"><span class="icon">ğŸ“‹</span> Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
      <div class="nav-section">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</div>
      <div class="nav-item" onclick="showPanel('welcome',this)"><span class="icon">ğŸ‘‹</span> Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</div>
      <div class="nav-item" onclick="showPanel('autoresponse',this)"><span class="icon">ğŸ¤–</span> Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
      <div class="nav-item" onclick="showPanel('ticket',this)"><span class="icon">ğŸ«</span> Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±</div>
      <div class="nav-section">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div>
      <div class="nav-item nav-premium-item" onclick="showPanel('premium',this)"><span class="icon">ğŸ‘‘</span> Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div>
    </nav>
    <div class="sidebar-user">
      <div class="sidebar-av-ph" id="sidebarAv">ØŸ</div>
      <div class="sidebar-uname" id="sidebarUname">...</div>
      <button class="btn-logout" onclick="logout()" title="Ø®Ø±ÙˆØ¬">â</button>
    </div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="page-title" id="pageTitle">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="plan-badge plan-free" id="planBadge">âš¡ Free</div>
    </div>

    <!-- OVERVIEW -->
    <div class="panel active" id="panel-overview">
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card"><div class="stat-icon" style="background:rgba(88,101,242,0.15);">â³</div><div><div class="stat-num">...</div><div class="stat-label">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div></div></div>
      </div>
      <div class="card">
        <div class="card-header"><h3>âš¡ Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</h3></div>
        <div id="overviewContent" style="color:var(--muted);text-align:center;padding:30px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
      </div>
    </div>

    <!-- PROTECTION -->
    <div class="panel" id="panel-protection">
      <div class="card">
        <div class="card-header"><h3>ğŸ›¡ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ©</h3><button class="btn btn-primary btn-sm" onclick="saveProtection()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="protectionContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- LOGS -->
    <div class="panel" id="panel-logs">
      <div class="card">
        <div class="card-header"><h3>ğŸ“‹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3><button class="btn btn-primary btn-sm" onclick="saveLogs()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="logsContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- WELCOME -->
    <div class="panel" id="panel-welcome">
      <div class="card">
        <div class="card-header"><h3>ğŸ‘‹ Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</h3><button class="btn btn-primary btn-sm" onclick="saveWelcome()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="welcomeContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- AUTO RESPONSE -->
    <div class="panel" id="panel-autoresponse">
      <div class="card">
        <div class="card-header"><h3>ğŸ¤– Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h3><button class="btn btn-primary btn-sm" onclick="showARForm()">+ Ø¥Ø¶Ø§ÙØ©</button></div>
        <div class="ar-list" id="arList"></div>
        <div id="arForm" style="display:none;background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:18px;">
          <div class="form-grid">
            <div class="form-group"><label class="form-label">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø´ØºÙÙ‘Ù„Ø©</label><input type="text" class="form-input" id="arTrigger" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø§Ø¹Ø¯Ø©"></div>
            <div class="form-group"><label class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„</label><select class="form-select" id="arType"><option value="contains">ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰</option><option value="startsWith">ÙŠØ¨Ø¯Ø£ Ø¨Ù€</option><option value="exact">ÙŠØ³Ø§ÙˆÙŠ ØªÙ…Ø§Ù…Ø§Ù‹</option></select></div>
          </div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø±Ø¯</label><textarea class="form-textarea" id="arResponse" placeholder="Ù†Øµ Ø§Ù„Ø±Ø¯..."></textarea></div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="addAR()">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="btn btn-ghost" onclick="document.getElementById('arForm').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TICKET -->
    <div class="panel" id="panel-ticket">
      <div class="card">
        <div class="card-header"><h3>ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±</h3><button class="btn btn-primary btn-sm" onclick="saveTicket()">ğŸ’¾ Ø­ÙØ¸</button></div>
        <div id="ticketContent"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <!-- PREMIUM -->
    <div class="panel" id="panel-premium">
      <div class="card" style="text-align:center;background:linear-gradient(135deg,var(--card),rgba(245,167,66,0.05));border-color:rgba(245,167,66,0.3);">
        <div style="font-size:2.5rem;margin-bottom:12px;">ğŸ‘‘</div>
        <h2 style="font-family:'Orbitron',monospace;font-size:1.6rem;background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;">XTRA PREMIUM</h2>
        <p style="color:var(--muted);margin-bottom:24px;">Ø§Ø±Ù‚Ù Ø¨Ø³ÙŠØ±ÙØ±Ùƒ Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ©</p>
        <div id="premiumStatus"></div>
      </div>
      <div class="plans-grid">
        <div class="plan-card">
          <div class="plan-name">FREE</div>
          <div class="plan-price">$0 <span>/Ø´Ù‡Ø±</span></div>
          <ul class="plan-features">
            <li class="yes">100 Ø£Ù…Ø± Ø£Ø³Ø§Ø³ÙŠ</li>
            <li class="yes">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± (Ù…Ø­Ø¯ÙˆØ¯)</li>
            <li class="yes">Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</li>
            <li class="yes">Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹</li>
            <li class="no">Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©</li>
            <li class="no">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</li>
            <li class="no">Ø¯Ø¹Ù… Ø£ÙˆÙ„ÙˆÙŠØ©</li>
          </ul>
          <button class="btn btn-ghost" style="width:100%;" disabled>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
        </div>
        <div class="plan-card featured">
          <div style="background:linear-gradient(135deg,#f5a742,#fee75c);color:#000;font-size:0.7rem;font-weight:900;padding:3px 12px;border-radius:999px;display:inline-block;margin-bottom:10px;">â­ Ø§Ù„Ø£ÙØ¶Ù„</div>
          <div class="plan-name" style="background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">PREMIUM</div>
          <div class="plan-price" style="background:linear-gradient(135deg,#f5a742,#fee75c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">$4.99 <span style="-webkit-text-fill-color:var(--muted);">/Ø´Ù‡Ø±</span></div>
          <ul class="plan-features">
            <li class="yes">ÙƒÙ„ Ù…ÙŠØ²Ø§Øª Free</li>
            <li class="yes">ØªØ°Ø§ÙƒØ± ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
            <li class="yes">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ HD</li>
            <li class="yes">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</li>
            <li class="yes">Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
            <li class="yes">Ø­Ù…Ø§ÙŠØ© AI Ù…ØªÙ‚Ø¯Ù…Ø©</li>
            <li class="yes">âš¡ Ø¯Ø¹Ù… Ø£ÙˆÙ„ÙˆÙŠØ© 24/7</li>
          </ul>
          <button class="btn btn-gold" style="width:100%;" onclick="toast('Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„Ø¯ÙØ¹ Ù‚Ø±ÙŠØ¨Ø§Ù‹!','success')">ğŸ‘‘ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
// ===== STATE =====
let currentGuildId = null;
let guildInfo = { channels: [], roles: [] };
let arResponses = [];

// ===== INIT =====
window.onload = async () => {
  await loadUser();
  await loadServers();
  document.getElementById('serversPage').style.display = 'block';
  if(window.innerWidth <= 900) document.getElementById('mobileBtn').style.display = 'flex';
};

// ===== LOAD USER =====
async function loadUser() {
  try {
    const res = await fetch('/api/me');
    if (!res.ok) { window.location.href = '/'; return; }
    const user = await res.json();
    const bar = document.getElementById('userBar');
    bar.innerHTML = `
      <img src="${user.avatar}" class="user-av" onerror="this.style.display='none'">
      <span style="font-weight:600;">${user.tag}</span>
      <button class="btn btn-ghost btn-sm" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    `;
    document.getElementById('sidebarUname').textContent = user.username;
    document.getElementById('sidebarAv').innerHTML = `<img src="${user.avatar}" class="sidebar-av" onerror="this.outerHTML='<div class=sidebar-av-ph>${user.username[0]}</div>'">`;
  } catch { window.location.href = '/'; }
}

// ===== LOAD SERVERS =====
async function loadServers() {
  try {
    const res = await fetch('/api/guilds');
    const guilds = await res.json();
    const grid = document.getElementById('serversGrid');
    if (!guilds.length) {
      grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:40px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ±ÙØ±Ø§Øª ØªÙ…Ù„ÙƒÙ‡Ø§ Ø£Ùˆ ØªØ¯ÙŠØ±Ù‡Ø§</div>';
      return;
    }
    grid.innerHTML = guilds.map(g => `
      <div class="server-card">
        ${g.isPremium ? '<div class="badge-premium">ğŸ‘‘ Premium</div>' : ''}
        ${g.icon
          ? `<img src="${g.icon}" class="server-icon" onerror="this.outerHTML='<div class=server-icon-placeholder style=background:linear-gradient(135deg,#5865F2,#7c3aed)>${g.name[0]}</div>'">`
          : `<div class="server-icon-placeholder" style="background:linear-gradient(135deg,#5865F2,#7c3aed);">${g.name[0]}</div>`
        }
        <div class="server-name">${g.name}</div>
        <div class="server-members">ğŸ‘¥ ${g.memberCount ? g.memberCount.toLocaleString() : '?'} Ø¹Ø¶Ùˆ</div>
        <div class="badge-bot ${g.hasBot ? 'active' : 'inactive'}">${g.hasBot ? 'â— Ø§Ù„Ø¨ÙˆØª Ù…ÙˆØ¬ÙˆØ¯' : 'â—‹ Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± Ù…Ø¶Ø§Ù'}</div>
        ${g.hasBot
          ? `<button class="btn-manage" onclick="enterDash('${g.id}','${g.name}','${g.icon||''}','${g.isPremium}')">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</button>`
          : `<a class="btn-add" href="https://discord.com/oauth2/authorize?client_id=${getClientId()}&permissions=8&scope=bot%20applications.commands&guild_id=${g.id}" target="_blank">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙˆØª</a>`
        }
      </div>
    `).join('');
  } catch {
    document.getElementById('serversGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--red);padding:40px;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª</div>';
  }
}

function getClientId() {
  return window._clientId || '';
}

// ===== ENTER DASHBOARD =====
async function enterDash(id, name, icon, isPremium) {
  currentGuildId = id;
  document.getElementById('serversPage').style.display = 'none';
  document.getElementById('dashPage').style.display = 'block';
  document.getElementById('sidebarName').textContent = name;

  if (icon) {
    document.getElementById('sidebarIcon').innerHTML = `<img src="${icon}" class="sidebar-server-icon" onerror="this.outerHTML='<div class=sidebar-server-icon-ph style=background:linear-gradient(135deg,#5865F2,#7c3aed)>${name[0]}</div>'">`;
  } else {
    document.getElementById('sidebarIcon').innerHTML = name[0];
  }

  const badge = document.getElementById('planBadge');
  if (isPremium === 'true') {
    badge.className = 'plan-badge plan-premium';
    badge.textContent = 'ğŸ‘‘ Premium';
  } else {
    badge.className = 'plan-badge plan-free';
    badge.textContent = 'âš¡ Free';
  }

  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
  try {
    const res = await fetch(`/api/guild/${id}/info`);
    guildInfo = await res.json();
  } catch { guildInfo = { channels: [], roles: [] }; }

  loadOverview();
  showPanel('overview', document.querySelector('.nav-item'));
}

function goServers() {
  document.getElementById('dashPage').style.display = 'none';
  document.getElementById('serversPage').style.display = 'block';
  currentGuildId = null;
}

function logout() { window.location.href = '/logout'; }

// ===== PANELS =====
const panelTitles = {
  overview: 'ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', protection: 'ğŸ›¡ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ©', logs: 'ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª',
  welcome: 'ğŸ‘‹ Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„ÙˆØ¯Ø§Ø¹', autoresponse: 'ğŸ¤– Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ',
  ticket: 'ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±', premium: 'ğŸ‘‘ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…'
};

function showPanel(name, el) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  if (el) el.classList.add('active');
  document.getElementById('pageTitle').textContent = panelTitles[name] || name;
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  const loaders = { protection: loadProtection, logs: loadLogs, welcome: loadWelcome, autoresponse: loadAR, ticket: loadTicket, premium: loadPremium };
  if (loaders[name]) loaders[name]();
  if (window.innerWidth <= 900) document.getElementById('sidebar').classList.remove('open');
}

// ===== OVERVIEW =====
async function loadOverview() {
  try {
    const res = await fetch(`/api/guild/${currentGuildId}/stats`);
    const stats = await res.json();
    document.getElementById('statsGrid').innerHTML = `
      <div class="stat-card"><div class="stat-icon" style="background:rgba(88,101,242,0.15);">ğŸ‘¥</div><div><div class="stat-num">${stats.memberCount.toLocaleString()}</div><div class="stat-label">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(87,242,135,0.15);">ğŸŸ¢</div><div><div class="stat-num">${stats.onlineCount.toLocaleString()}</div><div class="stat-label">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(0,212,255,0.15);">ğŸ«</div><div><div class="stat-num">${stats.openTickets}</div><div class="stat-label">ØªØ°Ø§ÙƒØ± Ù…ÙØªÙˆØ­Ø©</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(245,167,66,0.15);">ğŸ‘‘</div><div><div class="stat-num">${stats.isPremium ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</div><div class="stat-label">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</div></div></div>
    `;
    document.getElementById('overviewContent').innerHTML = `
      <div style="text-align:right;">
        <p style="margin-bottom:8px;color:var(--text);">âœ… Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ ÙÙŠ Ø³ÙŠØ±ÙØ± <strong>${document.getElementById('sidebarName').textContent}</strong></p>
        <p style="color:var(--muted);font-size:0.9rem;">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª</p>
      </div>
    `;
  } catch {
    document.getElementById('overviewContent').textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
  }
}

// ===== HELPERS =====
function channelOptions(selectedId) {
  return guildInfo.channels.map(c => `<option value="${c.id}" ${c.id === selectedId ? 'selected' : ''}># ${c.name}</option>`).join('');
}
function roleOptions(selectedId) {
  return guildInfo.roles.map(r => `<option value="${r.id}" ${r.id === selectedId ? 'selected' : ''}>@ ${r.name}</option>`).join('');
}

// ===== PROTECTION =====
async function loadProtection() {
  const res = await fetch(`/api/guild/${currentGuildId}/protection`);
  const d = await res.json();
  document.getElementById('protectionContent').innerHTML = `
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Raid ğŸš¨</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ù…ÙØ§Ø¬Ø¦</div></div><label class="toggle"><input type="checkbox" id="antiRaid" ${d.antiRaid ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Spam ğŸ’¬</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©</div></div><label class="toggle"><input type="checkbox" id="antiSpam" ${d.antiSpam ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Link ğŸ”—</div><div class="desc">Ø­Ø°Ù Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div></div><label class="toggle"><input type="checkbox" id="antiLink" ${d.antiLink ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Ad ğŸ“¢</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø¹ÙˆØ§Øª</div></div><label class="toggle"><input type="checkbox" id="antiAd" ${d.antiAd ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Mention Spam ğŸ“£</div><div class="desc">Ù…Ù†Ø¹ Ù…Ù†Ø´Ù† Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…ÙØ±Ø·</div></div><label class="toggle"><input type="checkbox" id="antiMention" ${d.antiMention ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">Anti-Emoji Spam ğŸ˜‚</div><div class="desc">Ù…Ù†Ø¹ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙØ±Ø·</div></div><label class="toggle"><input type="checkbox" id="antiEmoji" ${d.antiEmoji ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="form-grid" style="margin-top:20px;">
      <div class="form-group"><label class="form-label">Ø­Ø¯ Ø§Ù„Ø±ÙŠØ¯ <small>(Ø§Ù†Ø¶Ù…Ø§Ù… ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©)</small></label><input type="number" class="form-input" id="raidLimit" value="${d.raidLimit || 10}"></div>
      <div class="form-group"><label class="form-label">Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±ÙŠØ¯</label><select class="form-select" id="raidAction"><option value="lock" ${d.raidAction==='lock'?'selected':''}>Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±</option><option value="ban" ${d.raidAction==='ban'?'selected':''}>Ø­Ø¸Ø± Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</option><option value="kick" ${d.raidAction==='kick'?'selected':''}>Ø·Ø±Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</option></select></div>
    </div>
  `;
}

async function saveProtection() {
  const body = {
    antiRaid: document.getElementById('antiRaid').checked,
    antiSpam: document.getElementById('antiSpam').checked,
    antiLink: document.getElementById('antiLink').checked,
    antiAd: document.getElementById('antiAd').checked,
    antiMention: document.getElementById('antiMention').checked,
    antiEmoji: document.getElementById('antiEmoji').checked,
    raidLimit: parseInt(document.getElementById('raidLimit').value),
    raidAction: document.getElementById('raidAction').value,
  };
  const res = await fetch(`/api/guild/${currentGuildId}/protection`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  const d = await res.json();
  d.success ? toast('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ©', 'success') : toast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
}

// ===== LOGS =====
async function loadLogs() {
  const res = await fetch(`/api/guild/${currentGuildId}/logs`);
  const d = await res.json();
  document.getElementById('logsContent').innerHTML = `
    <div class="form-group"><label class="form-label">Ù‚Ù†Ø§Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</label><select class="form-select" id="logsChannel"><option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>${channelOptions(d.channel)}</select></div>
    <div class="toggle-row"><div class="toggle-label"><div class="name">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div></div><label class="toggle"><input type="checkbox" id="logsEnabled" ${d.enabled ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="logs-grid" style="margin-top:16px;">
      <div class="log-item">ğŸ‘‹ Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡<label class="toggle"><input type="checkbox" id="logJoin" ${d.memberJoin ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸšª Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡<label class="toggle"><input type="checkbox" id="logLeave" ${d.memberLeave ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„<label class="toggle"><input type="checkbox" id="logEdit" ${d.messageEdit ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„<label class="toggle"><input type="checkbox" id="logDelete" ${d.messageDelete ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸ”¨ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª<label class="toggle"><input type="checkbox" id="logPunish" ${d.punishments ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸ« Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ°Ø§ÙƒØ±<label class="toggle"><input type="checkbox" id="logTicket" ${d.ticketEvents ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸ¤ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙˆØª<label class="toggle"><input type="checkbox" id="logVoice" ${d.voiceEvents ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
      <div class="log-item">ğŸ”§ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±<label class="toggle"><input type="checkbox" id="logServer" ${d.serverChanges ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    </div>
  `;
}

async function saveLogs() {
  const body = {
    enabled: document.getElementById('logsEnabled').checked,
    channel: document.getElementById('logsChannel').value,
    memberJoin: document.getElementById('logJoin').checked,
    memberLeave: document.getElementById('logLeave').checked,
    messageEdit: document.getElementById('logEdit').checked,
    messageDelete: document.getElementById('logDelete').checked,
    punishments: document.getElementById('logPunish').checked,
    ticketEvents: document.getElementById('logTicket').checked,
    voiceEvents: document.getElementById('logVoice').checked,
    serverChanges: document.getElementById('logServer').checked,
  };
  const res = await fetch(`/api/guild/${currentGuildId}/logs`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  const d = await res.json();
  d.success ? toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'success') : toast('âŒ Ø®Ø·Ø£', 'error');
}

// ===== WELCOME =====
async function loadWelcome() {
  const res = await fetch(`/api/guild/${currentGuildId}/welcome`);
  const d = await res.json();
  document.getElementById('welcomeContent').innerHTML = `
    <div class="toggle-row"><div class="toggle-label"><div class="name">ØªÙØ¹ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ±Ø­ÙŠØ¨</div></div><label class="toggle"><input type="checkbox" id="welcomeEnabled" ${d.enabled ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="form-group" style="margin-top:16px;"><label class="form-label">Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨</label><select class="form-select" id="welcomeChannel"><option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>${channelOptions(d.channel)}</select></div>
    <div class="form-group"><label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ <small>({user} {server} {count})</small></label><textarea class="form-textarea" id="welcomeMsg">${d.message || ''}</textarea></div>
    <div class="form-group"><label class="form-label">Ø±ØªØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</label><select class="form-select" id="autoRole"><option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>${roleOptions(d.autoRole)}</select></div>
    <hr style="border-color:var(--border);margin:20px 0;">
    <div class="toggle-row"><div class="toggle-label"><div class="name">ØªÙØ¹ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ¯Ø§Ø¹</div></div><label class="toggle"><input type="checkbox" id="leaveEnabled" ${d.leaveEnabled ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="form-group" style="margin-top:16px;"><label class="form-label">Ù‚Ù†Ø§Ø© Ø§Ù„ÙˆØ¯Ø§Ø¹</label><select class="form-select" id="leaveChannel"><option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>${channelOptions(d.leaveChannel)}</select></div>
    <div class="form-group"><label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ¯Ø§Ø¹</label><textarea class="form-textarea" id="leaveMsg">${d.leaveMessage || ''}</textarea></div>
  `;
}

async function saveWelcome() {
  const body = {
    enabled: document.getElementById('welcomeEnabled').checked,
    channel: document.getElementById('welcomeChannel').value,
    message: document.getElementById('welcomeMsg').value,
    autoRole: document.getElementById('autoRole').value,
    leaveEnabled: document.getElementById('leaveEnabled').checked,
    leaveChannel: document.getElementById('leaveChannel').value,
    leaveMessage: document.getElementById('leaveMsg').value,
  };
  const res = await fetch(`/api/guild/${currentGuildId}/welcome`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  const d = await res.json();
  d.success ? toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠØ¨', 'success') : toast('âŒ Ø®Ø·Ø£', 'error');
}

// ===== AUTO RESPONSE =====
async function loadAR() {
  const res = await fetch(`/api/guild/${currentGuildId}/autoresponse`);
  arResponses = await res.json();
  renderAR();
}

function renderAR() {
  const list = document.getElementById('arList');
  if (!arResponses.length) {
    list.innerHTML = '<div style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© â€” Ø§Ø¶ØºØ· + Ø¥Ø¶Ø§ÙØ©</div>';
    return;
  }
  list.innerHTML = arResponses.map((ar, i) => `
    <div class="ar-item">
      <span class="ar-trigger">${ar.trigger}</span>
      <div class="ar-response">${ar.response}</div>
      <button class="ar-del" onclick="deleteAR(${i})">ğŸ—‘ï¸</button>
    </div>
  `).join('');
}

function showARForm() { document.getElementById('arForm').style.display = 'block'; }

async function addAR() {
  const trigger = document.getElementById('arTrigger').value.trim();
  const response = document.getElementById('arResponse').value.trim();
  if (!trigger || !response) { toast('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ø±Ø¯!', 'error'); return; }
  arResponses.push({ trigger, type: document.getElementById('arType').value, response });
  await saveAR();
  document.getElementById('arForm').style.display = 'none';
  document.getElementById('arTrigger').value = '';
  document.getElementById('arResponse').value = '';
  renderAR();
}

async function deleteAR(i) {
  arResponses.splice(i, 1);
  await saveAR();
  renderAR();
}

async function saveAR() {
  const res = await fetch(`/api/guild/${currentGuildId}/autoresponse`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ responses: arResponses }) });
  const d = await res.json();
  if (d.success) toast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success');
}

// ===== TICKET =====
async function loadTicket() {
  const res = await fetch(`/api/guild/${currentGuildId}/ticket`);
  const d = await res.json();
  document.getElementById('ticketContent').innerHTML = `
    <div class="toggle-row"><div class="toggle-label"><div class="name">ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±</div></div><label class="toggle"><input type="checkbox" id="ticketEnabled" ${d.enabled ? 'checked' : ''}><span class="toggle-slider"></span></label></div>
    <div class="form-grid" style="margin-top:16px;">
      <div class="form-group"><label class="form-label">Ù‚Ù†Ø§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø©</label><select class="form-select" id="ticketChannel"><option value="">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</option>${channelOptions(d.channel)}</select></div>
      <div class="form-group"><label class="form-label">Ø±ØªØ¨Ø© Ø§Ù„Ø¯Ø¹Ù…</label><select class="form-select" id="ticketRole"><option value="">Ø§Ø®ØªØ± Ø±ØªØ¨Ø©</option>${roleOptions(d.supportRole)}</select></div>
    </div>
    <div class="form-group"><label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ Embed</label><input type="text" class="form-input" id="ticketTitle" value="${d.title || 'ğŸ« Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ±'}"></div>
    <div class="form-group"><label class="form-label">ÙˆØµÙ Ø§Ù„Ù€ Embed</label><textarea class="form-textarea" id="ticketDesc">${d.description || ''}</textarea></div>
    <div class="form-group"><label class="form-label">Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="text" class="form-input" id="ticketBtn" value="${d.buttonText || 'ğŸ“© ÙØªØ­ ØªØ°ÙƒØ±Ø©'}"></div>
    <div class="form-group"><label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø©</label><textarea class="form-textarea" id="ticketWelcome">${d.welcomeMsg || ''}</textarea></div>
    <div class="save-bar"><span>Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ Ø³ØªÙØ±Ø³Ù„ Ø§Ù„Ù„ÙˆØ­Ø© Ù„Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</span><button class="btn btn-ghost" onclick="sendTicketPanel()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø©</button></div>
  `;
}

async function saveTicket() {
  const body = {
    enabled: document.getElementById('ticketEnabled').checked,
    channel: document.getElementById('ticketChannel').value,
    supportRole: document.getElementById('ticketRole').value,
    title: document.getElementById('ticketTitle').value,
    description: document.getElementById('ticketDesc').value,
    buttonText: document.getElementById('ticketBtn').value,
    welcomeMsg: document.getElementById('ticketWelcome').value,
  };
  const res = await fetch(`/api/guild/${currentGuildId}/ticket`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  const d = await res.json();
  d.success ? toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ°Ø§ÙƒØ±', 'success') : toast('âŒ Ø®Ø·Ø£', 'error');
}

function sendTicketPanel() { toast('ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù„ÙˆØ­Ø© Ù„Ù„Ù‚Ù†Ø§Ø©! (Ù…Ø­ØªØ§Ø¬ ÙƒÙˆØ¯ Ø§Ù„Ø¨ÙˆØª ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§)', 'success'); }

// ===== PREMIUM =====
async function loadPremium() {
  const res = await fetch(`/api/guild/${currentGuildId}/premium`);
  const d = await res.json();
  document.getElementById('premiumStatus').innerHTML = d.premium
    ? `<div style="background:rgba(87,242,135,0.1);border:1px solid rgba(87,242,135,0.3);border-radius:12px;padding:14px;color:var(--green);font-weight:700;">âœ… Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…ÙØ¹Ù‘Ù„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ${d.expiresAt ? '(ÙŠÙ†ØªÙ‡ÙŠ: '+new Date(d.expiresAt).toLocaleDateString('ar')+')'  : ''}</div>`
    : `<div style="background:rgba(107,114,128,0.1);border:1px solid var(--border);border-radius:12px;padding:14px;color:var(--muted);">Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</div>`;
}

// ===== TOAST =====
function toast(msg, type = 'success') {
  const wrap = document.getElementById('toastWrap');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.textContent = msg;
  wrap.appendChild(t);
  setTimeout(() => { t.style.opacity = '0'; t.style.transition = 'opacity 0.4s'; setTimeout(() => t.remove(), 400); }, 3000);
}
</script>
</body>
</html>
